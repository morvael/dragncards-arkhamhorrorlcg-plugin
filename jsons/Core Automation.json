{
    "actionLists": {
        "viewCardInfo": [
            ["DO_VIEW_CARD_INFO", "$ACTIVE_CARD_ID"]
        ]
    },
    "automation": {
        "postNewGameActionList": [
            ["COND",
                ["NOT_EQUAL", "$GAME.arkhamPostNewGameDone", true],
                [
                    ["SET", "/arkhamPostNewGameDone", true],
                    ["SET", "/arkhamScenarioInit", true],
                    ["SET", "/arkhamChaosBagCampaignName", "No Campaign"],
                    ["SET", "/arkhamCampaignName", "No Campaign"],
                    ["SET", "/arkhamScenarioName", "No Scenario"],
                    ["SET", "/arkhamScenarioDifficulty", "Normal"],
                    ["LOG", "Welcome to Arkham Horror. Set first player, load your decks, then load a scenario. Do not manipulate the board until the game begins."]
                ]
            ]
        ],
        "postSitDownActionList": [
            ["DO_UPDATE_INVESTIGATOR_NAMES"]
        ],
        "postLoadActionList": [
            ["SET", "/lastLoadedCardIds", "$GAME.loadedCardIds"],
            ["FOR_EACH_VAL", "$TARGET_ID", "$GAME.loadedCardIds", [
                ["VAR", "$TARGET", "$CARD_BY_ID.$TARGET_ID"],
                ["COND",
                    ["IN_STRING", "$TARGET.groupId", "player1"],
                    ["SET", "/cardById/$TARGET_ID/cardOwner", "player1"],
                    ["IN_STRING", "$TARGET.groupId", "player2"],
                    ["SET", "/cardById/$TARGET_ID/cardOwner", "player2"],
                    ["IN_STRING", "$TARGET.groupId", "player3"],
                    ["SET", "/cardById/$TARGET_ID/cardOwner", "player3"],
                    ["IN_STRING", "$TARGET.groupId", "player4"],
                    ["SET", "/cardById/$TARGET_ID/cardOwner", "player4"],
                    ["TRUE"],
                    [
                        ["SET", "/cardById/$TARGET_ID/cardOwner", "shared"],
                        ["COND",
                            ["OR",
                                ["EQUAL", "$TARGET.groupId", "sharedDeckA"],
                                ["EQUAL", "$TARGET.groupId", "sharedDiscardA"]
                            ],
                            [
                                ["SET", "/cardById/$TARGET_ID/cardDeck", "sharedDeckA"],
                                ["SET", "/cardById/$TARGET_ID/cardDiscard", "sharedDiscardA"]
                            ],
                            ["OR",
                                ["EQUAL", "$TARGET.groupId", "sharedDeckB"],
                                ["EQUAL", "$TARGET.groupId", "sharedDiscardB"]
                            ],
                            [
                                ["SET", "/cardById/$TARGET_ID/cardDeck", "sharedDeckB"],
                                ["SET", "/cardById/$TARGET_ID/cardDiscard", "sharedDiscardB"]
                            ],
                            ["OR",
                                ["EQUAL", "$TARGET.groupId", "sharedDeckC"],
                                ["EQUAL", "$TARGET.groupId", "sharedDiscardC"]
                            ],
                            [
                                ["SET", "/cardById/$TARGET_ID/cardDeck", "sharedDeckC"],
                                ["SET", "/cardById/$TARGET_ID/cardDiscard", "sharedDiscardC"]
                            ],
                            ["EQUAL", "$TARGET.groupId", "sharedPileA"],
                            [
                                ["SET", "/cardById/$TARGET_ID/cardDeck", "sharedPileA"],
                                ["SET", "/cardById/$TARGET_ID/cardDiscard", "sharedPileA"]
                            ],
                            ["EQUAL", "$TARGET.groupId", "sharedPileB"],
                            [
                                ["SET", "/cardById/$TARGET_ID/cardDeck", "sharedPileB"],
                                ["SET", "/cardById/$TARGET_ID/cardDiscard", "sharedPileB"]
                            ],
                            ["EQUAL", "$TARGET.groupId", "sharedPileC"],
                            [
                                ["SET", "/cardById/$TARGET_ID/cardDeck", "sharedPileC"],
                                ["SET", "/cardById/$TARGET_ID/cardDiscard", "sharedPileC"]
                            ],
                            ["EQUAL", "$TARGET.groupId", "sharedPileD"],
                            [
                                ["SET", "/cardById/$TARGET_ID/cardDeck", "sharedPileD"],
                                ["SET", "/cardById/$TARGET_ID/cardDiscard", "sharedPileD"]
                            ]
                        ],
                        ["COND",
                            ["AND",
                                ["EQUAL", "$GAME.arkhamScenarioInit", true],
                                ["EQUAL", "$TARGET.sides.A.type", "Scenario"],
                                ["EQUAL", "$TARGET.sides.B.type", "Scenario"],
                                ["EQUAL", "$TARGET.currentSide", "A"],
                                ["OR",
                                    ["EQUAL", "$GAME.arkhamScenarioDifficulty", "Hard"],
                                    ["EQUAL", "$GAME.arkhamScenarioDifficulty", "Expert"]
                                ]
                            ],
                            ["SET", "/cardById/$TARGET_ID/currentSide", "B"]
                        ],
                        ["COND",
                            ["AND",
                                ["EQUAL", "$GAME.arkhamScenarioInit", true],
                                ["EQUAL", "$TARGET.sides.A.type", "Location"],
                                ["EQUAL", "$TARGET.sides.B.type", "Location"],
                                ["EQUAL", "$TARGET.currentSide", "A"],
                                ["EQUAL", "$TARGET.sides.B.clues", null],
                                ["EQUAL", "$TARGET.sides.B.shroud", null]
                            ],
                            ["SET", "/cardById/$TARGET_ID/currentSide", "B"]
                        ]
                    ]
                ],
                ["SET", "/cardById/$TARGET_ID/controller", "$CARD_BY_ID.$TARGET_ID.cardOwner"]
            ]]
        ],
        "gameRules": [
            {
                "_comment": "Game step helpers.",
                "type": "trigger",
                "listenTo": ["/stepId"],
                "condition": [
                    ["AND",
                        ["EQUAL", "$GAME.arkhamScenarioInit", false],
                        ["OR",
                            ["EQUAL", "$GAME.stepId", "M1"],
                            ["EQUAL", "$GAME.stepId", "M2"],
                            ["EQUAL", "$GAME.stepId", "M3"],
                            ["EQUAL", "$GAME.stepId", "M4"],
                            ["EQUAL", "$GAME.stepId", "I2"],
                            ["EQUAL", "$GAME.stepId", "I2.2"],
                            ["EQUAL", "$GAME.stepId", "E2"],
                            ["EQUAL", "$GAME.stepId", "E3"],
                            ["EQUAL", "$GAME.stepId", "U2"],
                            ["EQUAL", "$GAME.stepId", "U3"],
                            ["EQUAL", "$GAME.stepId", "U4"],
                            ["EQUAL", "$GAME.stepId", "U5"]
                        ]
                    ]
                ],
                "then": [
                    ["COND",
                        ["EQUAL", "$GAME.stepId", "M1"],
                        ["DO_STEP_M1"],
                        ["EQUAL", "$GAME.stepId", "M2"],
                        ["DO_STEP_M2"],
                        ["EQUAL", "$GAME.stepId", "M3"],
                        ["DO_STEP_M3"],
                        ["EQUAL", "$GAME.stepId", "M4"],
                        ["DO_STEP_M4"],
                        ["EQUAL", "$GAME.stepId", "I2"],
                        ["DO_STEP_I2"],
                        ["EQUAL", "$GAME.stepId", "I2.2"],
                        ["DO_STEP_I2_2"],
                        ["EQUAL", "$GAME.stepId", "E2"],
                        ["DO_STEP_E2"],
                        ["EQUAL", "$GAME.stepId", "E3"],
                        ["DO_STEP_E3"],
                        ["EQUAL", "$GAME.stepId", "U2"],
                        ["DO_STEP_U2"],
                        ["EQUAL", "$GAME.stepId", "U3"],
                        ["DO_STEP_U3"],
                        ["EQUAL", "$GAME.stepId", "U4"],
                        ["DO_STEP_U4"],
                        ["EQUAL", "$GAME.stepId", "U5"],
                        ["DO_STEP_U5"]
                    ]
                ]
            },
            {
                "_comment": "Change card controller.",
                "type": "trigger",
                "listenTo": ["/cardById/*/groupId"],
                "condition": [
                    ["CAN_CHANGE_CONTROLLER", "$TARGET.id"]
                ],
                "then": [
                    ["DO_CHANGE_CONTROLLER", "$TARGET.id"]
                ]
            },
            {
                "_comment": "Change card inHand.",
                "type": "trigger",
                "listenTo": ["/cardById/*/groupId"],
                "condition": [
                    ["CAN_CHANGE_IN_HAND", "$TARGET.id"]
                ],
                "then": [
                    ["DO_CHANGE_IN_HAND", "$TARGET.id"]
                ]
            },
            {
                "_comment": "Change card inAdvanced.",
                "type": "trigger",
                "listenTo": ["/cardById/*/groupId"],
                "condition": [
                    ["CAN_CHANGE_IN_ADVANCED", "$TARGET.id"]
                ],
                "then": [
                    ["DO_CHANGE_IN_ADVANCED", "$TARGET.id"]
                ]
            },
            {
                "_comment": "Change card inPlay.",
                "type": "trigger",
                "listenTo": ["/cardById/*/groupId", "/cardById/*/attachmentDirection"],
                "condition": [
                    ["CAN_CHANGE_IN_PLAY", "$TARGET.id"]
                ],
                "then": [
                    ["DO_CHANGE_IN_PLAY", "$TARGET.id"]
                ]
            },
            {
                "_comment": "Change card inPlay in story group.",
                "type": "trigger",
                "listenTo": ["/groupById/sharedAgendaStory/stackIds", "/groupById/sharedActStory/stackIds", "/groupById/sharedActStoryB/stackIds", "/groupById/sharedActStoryC/stackIds", "/groupById/sharedActStoryD/stackIds", "/groupById/sharedActStoryE/stackIds"],
                "condition": [
                    ["AND",
                        ["EQUAL", "$GAME.arkhamScenarioInit", false],
                        ["GREATER_THAN", ["LENGTH", "$TARGET.stackIds"], 0]
                    ]
                ],
                "then": [
                    ["DO_REFRESH_STORY_IN_PLAY", "$TARGET.id"]
                ]
            },
            {
                "_comment": "Change attachedCount.",
                "type": "trigger",
                "listenTo": ["/cardById/*/parentCardId"],
                "condition": [
                    ["NOT_EQUAL", ["PREV", "$TARGET.parentCardId"], "$TARGET.parentCardId"]
                ],
                "then": [
                    ["VAR", "$OLD_PARENT_ID", ["PREV", "$TARGET.parentCardId"]],
                    ["COND",
                        ["AND",
                            ["NOT_EQUAL", "$OLD_PARENT_ID", null],
                            ["NOT_EQUAL", "$OLD_PARENT_ID", ""],
                            ["NOT_EQUAL", "$OLD_PARENT_ID", "$TARGET.id"]
                        ],
                        ["DECREASE_VAL", "/cardById/$OLD_PARENT_ID/attachedCount", 1]
                    ],
                    ["VAR", "$NEW_PARENT_ID", "$TARGET.parentCardId"],
                    ["COND",
                        ["AND",
                            ["NOT_EQUAL", "$NEW_PARENT_ID", null],
                            ["NOT_EQUAL", "$NEW_PARENT_ID", ""],
                            ["NOT_EQUAL", "$NEW_PARENT_ID", "$TARGET.id"]
                        ],
                        ["INCREASE_VAL", "/cardById/$NEW_PARENT_ID/attachedCount", 1]
                    ]
                ]
            },
            {
                "_comment": "Pay resource cost.",
                "type": "trigger",
                "listenTo": ["/cardById/*/inPlay"],
                "condition": [
                    ["AND",
                        ["EQUAL", "$GAME.arkhamScenarioInit", false],
                        ["NOT_EQUAL", "$TARGET.controller", "shared"],
                        ["NOT_EQUAL", "$TARGET.currentFace.cost", null],
                        ["GREATER_THAN", "$TARGET.currentFace.cost", 0],
                        ["EQUAL", "$TARGET.inPlay", true],
                        ["EQUAL", ["PREV", "$TARGET.inPlay"], false]
                    ]
                ],
                "then": [
                    ["VAR", "$TARGET_PLAYER", "$TARGET.controller"],
                    ["VAR", "$COST", "$TARGET.currentFace.cost"],
                    ["VAR", "$NAME", "$TARGET.currentFace.name"],
                    ["COND",
                        ["GREATER_EQUAL", "$PLAYER_DATA.$TARGET_PLAYER.resources", "$COST"],
                        [
                            ["DO_LOG", true, "$PLAYER_N", "$TARGET_PLAYER",
                                ["GET_NUMERIC_LOG", "spend ", "spend ", "$COST", " resource for {{$NAME}}.", " resources for {{$NAME}}."],
                                ["GET_NUMERIC_LOG", "spends ", "spends ", "$COST", " resource for {{$NAME}}.", " resources for {{$NAME}}."]],
                            ["DO_SPEND_RESOURCES", "$TARGET_PLAYER", "$COST", false, "$PLAYER_N"]
                        ],
                        ["TRUE"],
                        ["DO_LOG", true, "$PLAYER_N", "$TARGET_PLAYER",
                            ["GET_NUMERIC_LOG", "obliged to spend ", "obliged to spend ", "$COST", " resource for {{$NAME}}.", " resources for {{$NAME}}."],
                            ["GET_NUMERIC_LOG", "is obliged to spend ", "is obliged to spend ", "$COST", " resource for {{$NAME}}.", " resources for {{$NAME}}."]]
                    ]
                ]
            },
            {
                "_comment": "Add Uses resource tokens.",
                "type": "trigger",
                "listenTo": ["/cardById/*/inPlay"],
                "condition": [
                    ["AND",
                        ["EQUAL", "$GAME.arkhamScenarioInit", false],
                        ["EQUAL", "$TARGET.inPlay", true],
                        ["EQUAL", ["PREV", "$TARGET.inPlay"], false],
                        ["EQUAL", "$TARGET.usesPlaced", false],
                        ["GREATER_THAN", ["GET_CARD_USES", "$TARGET.id"], 0]
                    ]
                ],
                "then": [
                    ["DO_PLACE_RESOURCES_ON_CARD", "$PLAYER_N", "$TARGET.id", ["GET_CARD_USES", "$TARGET.id"], true, "$PLAYER_N"],
                    ["SET", "/cardById/$TARGET.id/usesPlaced", true]
                ]
            },
            {
                "_comment": "Add Location clue tokens (when entering play).",
                "type": "trigger",
                "listenTo": ["/cardById/*/inPlay"],
                "condition": [
                    ["AND",
                        ["EQUAL", "$GAME.arkhamScenarioInit", false],
                        ["EQUAL", "$TARGET.inPlay", true],
                        ["EQUAL", ["PREV", "$TARGET.inPlay"], false],
                        ["EQUAL", "$TARGET.cluesPlaced", false],
                        ["EQUAL", "$TARGET.currentFace.type", "Location"],
                        ["EQUAL", "$TARGET.groupId", "sharedLocations"],
                        ["NOT_EQUAL", "$TARGET.currentFace.clues", null],
                        ["GREATER_THAN", "$TARGET.currentFace.clues", 0]
                    ]
                ],
                "then": [
                    ["DO_PLACE_CLUES_ON_CARD", "$PLAYER_N", "$TARGET.id", ["GET_CARD_CLUES_REQUIREMENT", "$TARGET.id"], true, "$PLAYER_N"],
                    ["SET", "/cardById/$TARGET.id/cluesPlaced", true]
                ]
            },
            {
                "_comment": "Add Location clue tokens (when flipping).",
                "type": "trigger",
                "listenTo": ["/cardById/*/currentSide"],
                "condition": [
                    ["AND",
                        ["EQUAL", "$GAME.arkhamScenarioInit", false],
                        ["EQUAL", "$TARGET.inPlay", true],
                        ["EQUAL", "$TARGET.cluesPlaced", false],
                        ["EQUAL", "$TARGET.currentFace.type", "Location"],
                        ["EQUAL", "$TARGET.groupId", "sharedLocations"],
                        ["NOT_EQUAL", "$TARGET.currentFace.clues", null],
                        ["GREATER_THAN", "$TARGET.currentFace.clues", 0]
                    ]
                ],
                "then": [
                    ["DO_PLACE_CLUES_ON_CARD", "$PLAYER_N", "$TARGET.id", ["GET_CARD_CLUES_REQUIREMENT", "$TARGET.id"], true, "$PLAYER_N"],
                    ["SET", "/cardById/$TARGET.id/cluesPlaced", true]
                ]
            },
            {
                "_comment": "Make the Lead Investigator token follow first player (and create it when missing).",
                "type": "trigger",
                "listenTo": ["/firstPlayer"],
                "condition": [
                    ["NOT_EQUAL", ["PREV", "$GAME.firstPlayer"], "$GAME.firstPlayer"]
                ],
                "then": [
                    ["DO_UPDATE_LEAD_INVESTIGATOR_TOKEN"]
                ]
            }
        ]
    },
    "functions": {
        "GET_DESIRED_CONTROLLER": {
            "args": ["$TARGET_GROUP_ID"],
            "code": [
                ["VALIDATE_NOT_EMPTY", "$TARGET_GROUP_ID", "GET_DESIRED_CONTROLLER.TARGET_GROUP_ID"],
                ["COND",
                    ["OR",
                        ["EQUAL", "$TARGET_GROUP_ID", "sharedLocations"],
                        ["EQUAL", "$TARGET_GROUP_ID", "sharedVoid"],
                        ["EQUAL", "$TARGET_GROUP_ID", "sharedOffMap"]
                    ],
                    null,
                    ["IN_STRING", "$TARGET_GROUP_ID", "player1"],
                    "player1",
                    ["IN_STRING", "$TARGET_GROUP_ID", "player2"],
                    "player2",
                    ["IN_STRING", "$TARGET_GROUP_ID", "player3"],
                    "player3",
                    ["IN_STRING", "$TARGET_GROUP_ID", "player4"],
                    "player4",
                    ["TRUE"],
                    "shared"
                ]
            ]
        },
        "CAN_CHANGE_CONTROLLER": {
            "args": ["$TARGET_CARD_ID"],
            "code": [
                ["VAR", "$TARGET_CARD", ["GET_CARD_AND_VALIDATE", "$TARGET_CARD_ID", "CAN_CHANGE_CONTROLLER.TARGET_CARD_ID"]],
                ["COND",
                    ["AND",
                        ["NOT_EQUAL", "$TARGET_CARD.controller", ""],
                        ["NOT_EQUAL", "$TARGET_CARD.groupId", null],
                        ["OR",
                            ["NOT_EQUAL", "$TARGET_CARD.controller", "shared"],
                            ["EQUAL", "$TARGET_CARD.sides.B.name", "Player Card"]
                        ]
                    ],
                    [
                        ["VAR", "$NEW_CONTROLLER", ["GET_DESIRED_CONTROLLER", "$TARGET_CARD.groupId"]],
                        ["AND",
                            ["NOT_EQUAL", "$NEW_CONTROLLER", null],
                            ["NOT_EQUAL", "$TARGET_CARD.controller", "$NEW_CONTROLLER"]
                        ]
                    ],
                    ["TRUE"],
                    false
                ]
            ]
        },
        "DO_CHANGE_CONTROLLER": {
            "args": ["$TARGET_CARD_ID"],
            "code": [
                ["VAR", "$TARGET_CARD", ["GET_CARD_AND_VALIDATE", "$TARGET_CARD_ID", "DO_CHANGE_CONTROLLER.TARGET_CARD_ID"]],
                ["VAR", "$OLD_CONTROLLER", "$TARGET_CARD.controller"],
                ["VAR", "$NEW_CONTROLLER", ["GET_DESIRED_CONTROLLER", "$TARGET_CARD.groupId"]],
                ["VAR", "$NEW_CONTROLLER_ORIG", "$NEW_CONTROLLER"],
                ["COND",
                    ["NOT_EQUAL", "$OLD_CONTROLLER", "shared"],
                    ["UPDATE_VAR", "$OLD_CONTROLLER", ["GET_ALIAS", "$OLD_CONTROLLER"]],
                    ["TRUE"],
                    ["UPDATE_VAR", "$OLD_CONTROLLER", "the scenario"]
                ],
                ["COND",
                    ["NOT_EQUAL", "$NEW_CONTROLLER", "shared"],
                    ["UPDATE_VAR", "$NEW_CONTROLLER", ["GET_ALIAS", "$NEW_CONTROLLER"]],
                    ["TRUE"],
                    ["UPDATE_VAR", "$NEW_CONTROLLER", "the scenario"]
                ],
                ["LOG", "└── {{$TARGET_CARD.currentFace.name}} changes controller from {{$OLD_CONTROLLER}} to {{$NEW_CONTROLLER}}."],
                ["SET", "/cardById/$TARGET_CARD_ID/controller", "$NEW_CONTROLLER_ORIG"]
            ]
        },
        "GET_DESIRED_IN_HAND": {
            "args": ["$TARGET_GROUP_ID"],
            "code": [
                ["VAR", "$TARGET_GROUP", ["GET_GROUP_AND_VALIDATE", "$TARGET_GROUP_ID", "GET_DESIRED_IN_HAND.TARGET_GROUP_ID"]],
                ["EQUAL", "$TARGET_GROUP.groupType", "hand"]
            ]
        },
        "CAN_CHANGE_IN_HAND": {
            "args": ["$TARGET_CARD_ID"],
            "code": [
                ["VAR", "$TARGET_CARD", ["GET_CARD_AND_VALIDATE", "$TARGET_CARD_ID", "CAN_CHANGE_IN_HAND.TARGET_CARD_ID"]],
                ["AND",
                    ["NOT_EQUAL", "$TARGET_CARD.groupId", null],
                    ["NOT_EQUAL", "$TARGET_CARD.inHand", ["GET_DESIRED_IN_HAND", "$TARGET_CARD.groupId"]]
                ]
            ]
        },
        "DO_CHANGE_IN_HAND": {
            "args": ["$TARGET_CARD_ID"],
            "code": [
                ["VAR", "$TARGET_CARD", ["GET_CARD_AND_VALIDATE", "$TARGET_CARD_ID", "DO_CHANGE_IN_HAND.TARGET_CARD_ID"]],
                ["SET", "/cardById/$TARGET_CARD_ID/inHand", ["GET_DESIRED_IN_HAND", "$TARGET_CARD.groupId"]]
            ]
        },
        "GET_DESIRED_IN_ADVANCED": {
            "args": ["$TARGET_GROUP_ID"],
            "code": [
                ["VAR", "$TARGET_GROUP", ["GET_GROUP_AND_VALIDATE", "$TARGET_GROUP_ID", "GET_DESIRED_IN_ADVANCED.TARGET_GROUP_ID"]],
                ["EQUAL", "$TARGET_GROUP.canHaveAttachments", true]
            ]
        },
        "CAN_CHANGE_IN_ADVANCED": {
            "args": ["$TARGET_CARD_ID"],
            "code": [
                ["VAR", "$TARGET_CARD", ["GET_CARD_AND_VALIDATE", "$TARGET_CARD_ID", "CAN_CHANGE_IN_ADVANCED.TARGET_CARD_ID"]],
                ["AND",
                    ["NOT_EQUAL", "$TARGET_CARD.groupId", null],
                    ["NOT_EQUAL", "$TARGET_CARD.inAdvanced", ["GET_DESIRED_IN_ADVANCED", "$TARGET_CARD.groupId"]]
                ]
            ]
        },
        "DO_CHANGE_IN_ADVANCED": {
            "args": ["$TARGET_CARD_ID"],
            "code": [
                ["VAR", "$TARGET_CARD", ["GET_CARD_AND_VALIDATE", "$TARGET_CARD_ID", "DO_CHANGE_IN_ADVANCED.TARGET_CARD_ID"]],
                ["SET", "/cardById/$TARGET_CARD_ID/inAdvanced", ["GET_DESIRED_IN_ADVANCED", "$TARGET_CARD.groupId"]]
            ]
        },
        "GET_DESIRED_IN_PLAY": {
            "args": ["$TARGET_CARD_ID"],
            "code": [
                ["VAR", "$TARGET_CARD", ["GET_CARD_AND_VALIDATE", "$TARGET_CARD_ID", "GET_DESIRED_IN_PLAY.TARGET_CARD_ID"]],
                ["VAR", "$TARGET_GROUP", ["GET_GROUP_AND_VALIDATE", "$TARGET_CARD.groupId", "GET_DESIRED_IN_PLAY.TARGET_CARD.groupId"]],
                ["AND",
                    ["NOT_EQUAL", "$TARGET_CARD.attachmentDirection", "behind"],
                    ["IN_STRING", "$TARGET_GROUP.groupType", "inPlay"]
                ]
            ]
        },
        "CAN_CHANGE_IN_PLAY": {
            "args": ["$TARGET_CARD_ID"],
            "code": [
                ["VAR", "$TARGET_CARD", ["GET_CARD_AND_VALIDATE", "$TARGET_CARD_ID", "CAN_CHANGE_IN_PLAY.TARGET_CARD_ID"]],
                ["AND",
                    ["NOT_EQUAL", "$TARGET_CARD.groupId", null],
                    ["NOT_EQUAL", "$TARGET_CARD.groupId", "sharedAgendaStory"],
                    ["NOT", ["IN_STRING", "$TARGET_CARD.groupId", "sharedActStory"]],
                    ["NOT_EQUAL", "$TARGET_CARD.inPlay", ["GET_DESIRED_IN_PLAY", "$TARGET_CARD_ID"]]
                ]
            ]
        },
        "DO_CHANGE_IN_PLAY": {
            "args": ["$TARGET_CARD_ID"],
            "code": [
                ["VAR", "$TARGET_CARD", ["GET_CARD_AND_VALIDATE", "$TARGET_CARD_ID", "DO_CHANGE_IN_PLAY.TARGET_CARD_ID"]],
                ["VAR", "$DESIRED_IN_PLAY", ["GET_DESIRED_IN_PLAY", "$TARGET_CARD_ID"]],
                ["SET", "/cardById/$TARGET_CARD_ID/inPlay", "$DESIRED_IN_PLAY"],
                ["COND",
                    ["AND",
                        ["EQUAL", "$DESIRED_IN_PLAY", false],
                        ["EQUAL", "$TARGET_CARD.cluesPlaced", true]
                    ],
                    ["SET", "/cardById/$TARGET_CARD_ID/cluesPlaced", false]
                ],
                ["COND",
                    ["AND",
                        ["EQUAL", "$DESIRED_IN_PLAY", false],
                        ["EQUAL", "$TARGET_CARD.usesPlaced", true]
                    ],
                    ["SET", "/cardById/$TARGET_CARD_ID/usesPlaced", false]
                ]
            ]
        },
        "DO_REFRESH_STORY_IN_PLAY": {
            "args": ["$TARGET_GROUP_ID"],
            "code": [
                ["VAR", "$TARGET_GROUP", ["GET_GROUP_AND_VALIDATE", "$TARGET_GROUP_ID", "DO_REFRESH_STORY_IN_PLAY.TARGET_GROUP_ID"]],
                ["VAR", "$SORT_ORDER", 0],
                ["COND",
                    ["EQUAL", "$TARGET_GROUP_ID", "sharedActStory"],
                    ["UPDATE_VAR", "$SORT_ORDER", 1],
                    ["EQUAL", "$TARGET_GROUP_ID", "sharedActStoryB"],
                    ["UPDATE_VAR", "$SORT_ORDER", 2],
                    ["EQUAL", "$TARGET_GROUP_ID", "sharedActStoryC"],
                    ["UPDATE_VAR", "$SORT_ORDER", 3],
                    ["EQUAL", "$TARGET_GROUP_ID", "sharedActStoryD"],
                    ["UPDATE_VAR", "$SORT_ORDER", 4],
                    ["EQUAL", "$TARGET_GROUP_ID", "sharedActStoryE"],
                    ["UPDATE_VAR", "$SORT_ORDER", 5]
                ],
                ["VAR", "$IN_PLAY", true],
                ["FOR_EACH_VAL", "$STACK_ID", "$TARGET_GROUP.stackIds", [
                    ["VAR", "$STACK", "$STACK_BY_ID.$STACK_ID"],
                    ["FOR_EACH_VAL", "$TARGET_CARD_ID", "$STACK.cardIds", [
                        ["VAR", "$TARGET_CARD", "$CARD_BY_ID.$TARGET_CARD_ID"],
                        ["VAR", "$DESIRED_IN_PLAY", ["AND",
                            ["EQUAL", "$IN_PLAY", true],
                            ["NOT_EQUAL", "$TARGET_CARD.attachmentDirection", "behind"]
                        ]],
                        ["COND",
                            ["NOT_EQUAL", "$TARGET_CARD.inPlay", "$DESIRED_IN_PLAY"],
                            [
                                ["SET", "/cardById/$TARGET_CARD_ID/inPlay", "$DESIRED_IN_PLAY"],
                                ["COND",
                                    ["AND",
                                        ["EQUAL", "$DESIRED_IN_PLAY", false],
                                        ["EQUAL", "$TARGET_CARD.cluesPlaced", true]
                                    ],
                                    ["SET", "/cardById/$TARGET_CARD_ID/cluesPlaced", false]
                                ],
                                ["COND",
                                    ["AND",
                                        ["EQUAL", "$DESIRED_IN_PLAY", false],
                                        ["EQUAL", "$TARGET_CARD.usesPlaced", true]
                                    ],
                                    ["SET", "/cardById/$TARGET_CARD_ID/usesPlaced", false]
                                ]
                            ]
                        ],
                        ["COND",
                            ["NOT_EQUAL", "$TARGET_CARD.sortOrder", "$SORT_ORDER"],
                            ["SET", "/cardById/$TARGET_CARD_ID/sortOrder", "$SORT_ORDER"]
                        ]
                    ]],
                    ["UPDATE_VAR", "$IN_PLAY", false]
                ]]
            ]
        },
        "DO_REFRESH_ALL_STORIES_IN_PLAY": {
            "args": [],
            "code": [
                ["DO_REFRESH_STORY_IN_PLAY", "sharedAgendaStory"],
                ["DO_REFRESH_STORY_IN_PLAY", "sharedActStory"],
                ["DO_REFRESH_STORY_IN_PLAY", "sharedActStoryB"],
                ["DO_REFRESH_STORY_IN_PLAY", "sharedActStoryC"],
                ["DO_REFRESH_STORY_IN_PLAY", "sharedActStoryD"],
                ["DO_REFRESH_STORY_IN_PLAY", "sharedActStoryE"]
            ]
        },
        "GET_CONTROLLER_INVESTIGATOR": {
            "args": ["$CONTROLLER"],
            "code": [
                ["VALIDATE_NOT_EMPTY", "$CONTROLLER", "GET_CONTROLLER_INVESTIGATOR.CONTROLLER"],
                "{{$CONTROLLER}}Investigator"
            ]
        },
        "GET_CONTROLLER_PLAY": {
            "args": ["$CONTROLLER"],
            "code": [
                ["VALIDATE_NOT_EMPTY", "$CONTROLLER", "GET_CONTROLLER_PLAY.CONTROLLER"],
                "{{$CONTROLLER}}Play"
            ]
        },
        "GET_CONTROLLER_THREAT": {
            "args": ["$CONTROLLER"],
            "code": [
                ["VALIDATE_NOT_EMPTY", "$CONTROLLER", "GET_CONTROLLER_THREAT.CONTROLLER"],
                "{{$CONTROLLER}}Threat"
            ]
        },
        "GET_CONTROLLER_HAND": {
            "args": ["$CONTROLLER"],
            "code": [
                ["VALIDATE_NOT_EMPTY", "$CONTROLLER", "GET_CONTROLLER_HAND.CONTROLLER"],
                "{{$CONTROLLER}}Hand"
            ]
        },
        "GET_CONTROLLER_DECK": {
            "args": ["$CONTROLLER"],
            "code": [
                ["VALIDATE_NOT_EMPTY", "$CONTROLLER", "GET_CONTROLLER_DECK.CONTROLLER"],
                ["COND",
                    ["EQUAL", "$CONTROLLER", "shared"],
                    "sharedEncounterDeck",
                    ["TRUE"],
                    "{{$CONTROLLER}}Deck"
                ]
            ]
        },
        "GET_CONTROLLER_DISCARD": {
            "args": ["$CONTROLLER"],
            "code": [
                ["VALIDATE_NOT_EMPTY", "$CONTROLLER", "GET_CONTROLLER_DISCARD.CONTROLLER"],
                ["COND",
                    ["EQUAL", "$CONTROLLER", "shared"],
                    "sharedEncounterDiscard",
                    ["TRUE"],
                    "{{$CONTROLLER}}Discard"
                ]
            ]
        },
        "GET_CONTROLLER_ASIDE": {
            "args": ["$CONTROLLER"],
            "code": [
                ["VALIDATE_NOT_EMPTY", "$CONTROLLER", "GET_CONTROLLER_ASIDE.CONTROLLER"],
                "{{$CONTROLLER}}Aside"
            ]
        },
        "GET_CONTROLLER_REMOVED": {
            "args": ["$CONTROLLER"],
            "code": [
                ["VALIDATE_NOT_EMPTY", "$CONTROLLER", "GET_CONTROLLER_REMOVED.CONTROLLER"],
                "{{$CONTROLLER}}Removed"
            ]
        },
        "GET_CONTROLLER_EXILED": {
            "args": ["$CONTROLLER"],
            "code": [
                ["VALIDATE_NOT_EMPTY", "$CONTROLLER", "GET_CONTROLLER_EXILED.CONTROLLER"],
                "{{$CONTROLLER}}Exiled"
            ]
        },
        "GET_CONTROLLER_SIDE_DECK": {
            "args": ["$CONTROLLER"],
            "code": [
                ["VALIDATE_NOT_EMPTY", "$CONTROLLER", "GET_CONTROLLER_SIDE_DECK.CONTROLLER"],
                "{{$CONTROLLER}}SideDeck"
            ]
        },
        "GET_PLAYER_CONTROLLER": {
            "args": ["$TARGET_PLAYER", "$TARGET_CARD_ID"],
            "code": [
                ["VALIDATE_PLAYER", "$TARGET_PLAYER", "GET_PLAYER_CONTROLLER.TARGET_PLAYER"],
                ["VAR", "$TARGET_CARD", ["GET_CARD_AND_VALIDATE", "$TARGET_CARD_ID", "GET_PLAYER_CONTROLLER.TARGET_CARD_ID"]],
                ["COND",
                    ["EQUAL", "$TARGET_CARD.controller", "shared"],
                    "$TARGET_PLAYER",
                    ["TRUE"],
                    "$TARGET_CARD.controller"
                ]
            ]
        },
        "GET_CARD_NAME": {
            "args": ["$TARGET_CARD_ID"],
            "code": [
                ["VAR", "$TARGET_CARD", ["GET_CARD_AND_VALIDATE", "$TARGET_CARD_ID", "GET_CARD_NAME.TARGET_CARD_ID"]],
                ["COND",
                    ["EQUAL", "$TARGET_CARD.inHand", true],
                    "$TARGET_CARD.sides.A.name",
                    ["TRUE"],
                    "$TARGET_CARD.currentFace.name"
                ]
            ]
        },
        "DO_STEP_M1": {
            "args": [],
            "code": [
                ["LOG", "└── Round number advances."],
                ["INCREASE_VAL", "/roundNumber", 1]
            ]
        },
        "DO_STEP_M2": {
            "args": [],
            "code": [
                ["VAR", "$CURRENT_AGENDAS", ["GET_CURRENT_AGENDAS"]],
                ["COND",
                    ["GREATER_THAN", ["LENGTH", "$CURRENT_AGENDAS"], 0],
                    ["PROMPT", "$PLAYER_N", "askToPlaceDoomOnCurrentAgenda"]
                ]
            ]
        },
        "DO_STEP_M3": {
            "args": [],
            "code": [
                ["VAR", "$CURRENT_AGENDAS", ["GET_CURRENT_AGENDAS"]],
                ["COND",
                    ["GREATER_THAN", ["LENGTH", "$CURRENT_AGENDAS"], 0],
                    [
                        ["VAR", "$MESSAGE", "└──"],
                        ["VAR", "$ADVANCABLE_AGENDAS", ["LIST"]],
                        ["FOR_EACH_VAL", "$CARD", "$CURRENT_AGENDAS", [
                            ["VAR", "$DOOM_REQUIRED", ["GET_CARD_DOOM_REQUIREMENT", "$CARD.id"]],
                            ["VAR", "$DOOM_ACCRUED", ["GET_DOOM_ACCRUED", "$CARD.id"]],
                            ["COND",
                                ["AND",
                                    ["GREATER_THAN", "$DOOM_REQUIRED", 0],
                                    ["GREATER_EQUAL", "$DOOM_ACCRUED", "$DOOM_REQUIRED"]
                                ],
                                [
                                    ["UPDATE_VAR", "$MESSAGE", "{{$MESSAGE}} {{$DOOM_ACCRUED}} of {{$DOOM_REQUIRED}} doom required by {{$CARD.currentFace.name}} to advance was accrued."],
                                    ["UPDATE_VAR", "$ADVANCABLE_AGENDAS", ["APPEND", "$ADVANCABLE_AGENDAS", "$CARD"]]
                                ]
                            ]
                        ]],
                        ["VAR", "$ADVANCABLE_AGENDAS_COUNT", ["LENGTH", "$ADVANCABLE_AGENDAS"]],
                        ["COND",
                            ["GREATER_THAN", "$ADVANCABLE_AGENDAS_COUNT", 1],
                            [
                                ["LOG", "$MESSAGE"],
                                ["PROMPT", "$PLAYER_N", "pickAgendaToAdvance"],
                                ["VAR", "$INDEX", 0],
                                ["FOR_EACH_VAL", "$CARD", "$ADVANCABLE_AGENDAS", [
                                    ["VAR", "$LETTER", ["SUBSTRING", "123456789", "$INDEX", 1]],
                                    ["PROMPT_ADD_OPTION", "$PLAYER_N", "{{$CARD.currentFace.name}}", "{{$LETTER}}", ["LIST", "DO_ADVANCE_STORY_STR", "{{$PLAYER_N}}", "{{$CARD.groupId}}", "true", "{{$PLAYER_N}}"]],
                                    ["INCREASE_VAR", "$INDEX", 1]
                                ]],
                                ["PROMPT_ADD_OPTION", "$PLAYER_N", "Cancel", "X", ["LIST"]]
                            ],
                            ["EQUAL", "$ADVANCABLE_AGENDAS_COUNT", 1],
                            [
                                ["LOG", "$MESSAGE"],
                                ["DO_ADVANCE_STORY", "$PLAYER_N", "$ADVANCABLE_AGENDAS.[0].groupId", true, "$PLAYER_N"]
                            ]
                        ]
                    ]
                ]
            ]
        },
        "DO_STEP_M4": {
            "args": [],
            "code": [
                ["PROMPT", "$GAME.firstPlayer", "askToDrawEncounterCard"]
            ]
        },
        "DO_STEP_I2": {
            "args": [],
            "code": [
                ["COND",
                    ["EQUAL", "$GAME.arkhamActiveInvestigator", null],
                    [
                        ["VAR", "$ACTIVE_MINI_INVESTIGATORS", ["GET_ACTIVE_MINI_INVESTIGATORS"]],
                        ["VAR", "$REMAINING", ["LENGTH", "$ACTIVE_MINI_INVESTIGATORS"]],
                        ["COND",
                            ["GREATER_THAN", "$REMAINING", 1],
                            ["LOG", "└── There are {{$REMAINING}} investigators left who didn't take their turn yet."],
                            ["EQUAL", "$REMAINING", 1],
                            [
                                ["LOG", "└── There is 1 investigator left who didn't take their turn yet."],
                                ["DO_START_INVESTIGATOR_TURN", "$ACTIVE_MINI_INVESTIGATORS.[0].cardOwner", "$ACTIVE_MINI_INVESTIGATORS.[0].id", true, "$PLAYER_N"]
                            ],
                            ["TRUE"],
                            ["SET", "/stepId", "I3"]
                        ]
                    ]
                ]
            ]
        },
        "DO_STEP_I2_2": {
            "args": [],
            "code": [
                ["COND",
                    ["NOT_EQUAL", "$GAME.arkhamActiveInvestigator", null],
                    [
                        ["VAR", "$MINI_INVESTIGATOR", ["GET_MINI_INVESTIGATOR", "$GAME.arkhamActiveInvestigator"]],
                        ["DO_END_INVESTIGATOR_TURN", "$MINI_INVESTIGATOR.cardOwner", "$MINI_INVESTIGATOR.id", true, "$PLAYER_N"]
                    ]
                ],
                ["COND",
                    ["AND",
                        ["EQUAL", "$GAME.loopUntilInvestigatorsDone", true],
                        ["GREATER_THAN", ["LENGTH", ["GET_ACTIVE_MINI_INVESTIGATORS"]], 0]
                    ],
                    ["SET", "/stepId", "I2"],
                    ["TRUE"],
                    ["SET", "/stepId", "I3"]
                ]
            ]
        },
        "DO_STEP_E2": {
            "args": [],
            "code": [
                ["COND",
                    ["GREATER_THAN", ["GET_READY_ENEMIES_COUNT"], 0],
                    ["LOG", "└── Hunter or Patrol enemies move."]
                ]
            ]
        },
        "DO_STEP_E3": {
            "args": [],
            "code": [
                ["COND",
                    ["GREATER_THAN", ["GET_READY_ENEMIES_COUNT"], 0],
                    ["LOG", "└── Engaged enemies attack."]
                ]
            ]
        },
        "DO_STEP_U2": {
            "args": [],
            "code": [
                ["LOG", "└── Actions are reset."],
                ["FOR_EACH_VAL", "$PLAYER_I", "$PLAYER_ORDER", [
                    ["SET", "/playerData/$PLAYER_I/actionsTaken", 0],
                    ["VAR", "$INVESTIGATOR", ["GET_INVESTIGATOR", "$PLAYER_I"]],
                    ["VAR", "$MINI_INVESTIGATOR", ["GET_MINI_INVESTIGATOR", "$PLAYER_I"]],
                    ["COND",
                        ["AND",
                            ["NOT_EQUAL", "$INVESTIGATOR", null],
                            ["NOT_EQUAL", "$INVESTIGATOR.eliminated", true],
                            ["NOT_EQUAL", "$MINI_INVESTIGATOR", null],
                            ["NOT_EQUAL", "$MINI_INVESTIGATOR.eliminated", true],
                            ["EQUAL", "$MINI_INVESTIGATOR.groupId", "sharedLocations"]
                        ],
                        [
                            ["UNSET", "/cardById/$INVESTIGATOR.id/borderColor"],
                            ["UNSET", "/cardById/$MINI_INVESTIGATOR.id/borderColor"],
                            ["SET", "/cardById/$MINI_INVESTIGATOR.id/currentSide", "A"]
                        ]
                    ]
                ]],
                ["SET", "/arkhamActiveInvestigator", null]
            ]
        },
        "DO_STEP_U3": {
            "args": [],
            "code": [
                ["VAR", "$EXHAUSTED", ["LENGTH", ["GET_ALL_EXHAUSTED_CARDS", "$PLAYER_N", "$PLAYER_N"]]],
                ["COND",
                    ["GREATER_THAN", "$EXHAUSTED", 0],
                    ["PROMPT", "$PLAYER_N", "askToReadyAllCards"]
                ]
            ]
        },
        "DO_STEP_U4": {
            "args": [],
            "code": [
                ["PROMPT", "$GAME.firstPlayer", "askToDrawPlayerCard"]
            ]
        },
        "DO_STEP_U5": {
            "args": [],
            "code": [
                ["DO_CHECK_HAND_SIZE", "$GAME.firstPlayer"]
            ]
        },
        "DO_CHECK_HAND_SIZE": {
            "args": ["$TARGET_PLAYER"],
            "code": [
                ["COND",
                    ["NOT_EQUAL", "$TARGET_PLAYER", null],
                    [
                        ["VALIDATE_PLAYER", "$TARGET_PLAYER", "DO_CHECK_HAND_SIZE.TARGET_PLAYER"],
                        ["VAR", "$HAND_ID", ["GET_CONTROLLER_HAND", "$TARGET_PLAYER"]],
                        ["VAR", "$CARDS_IN_HAND", ["GET_ALL_CARDS_IN_GROUP_COUNT", "$HAND_ID"]],
                        ["COND",
                            ["GREATER_THAN", "$CARDS_IN_HAND", 8],
                            [
                                ["VAR", "$CARDS_TO_DISCARD", ["SUBTRACT", "$CARDS_IN_HAND", 8]],
                                ["PROMPT", "$TARGET_PLAYER", "askToDiscardExcessCards", "$CARDS_TO_DISCARD"]
                            ],
                            ["TRUE"],
                            ["DO_CHECK_HAND_SIZE", ["GET_NEXT_ACTIVE_PLAYER", "$TARGET_PLAYER"]]
                        ]
                    ]
                ]
            ]
        },
        "DO_UPDATE_LEAD_INVESTIGATOR_TOKEN": {
            "args": [],
            "code": [
                ["VAR", "$INVESTIGATOR", ["GET_INVESTIGATOR", "$GAME.firstPlayer"]],
                ["COND",
                    ["NOT_EQUAL", "$INVESTIGATOR", null],
                    [
                        ["VAR", "$LEAD_INVESTIGATOR_TOKEN", ["GET_LEAD_INVESTIGATOR_TOKEN"]],
                        ["COND",
                            ["EQUAL", "$LEAD_INVESTIGATOR_TOKEN", null],
                            [
                                ["DO_CREATE_CARDS", "$GAME.firstPlayer", "Lead investigator Token", "first_investigator", 1, "sharedTokens", true, null],
                                ["UPDATE_VAR", "$LEAD_INVESTIGATOR_TOKEN", ["GET_LEAD_INVESTIGATOR_TOKEN"]]
                            ]
                        ],
                        ["COND",
                            ["NOT_EQUAL", "$INVESTIGATOR.id", "$LEAD_INVESTIGATOR_TOKEN.parentCardId"],
                            [
                                ["LOG", "└── ", ["GET_ALIAS", "$GAME.firstPlayer"], " attaches {{$LEAD_INVESTIGATOR_TOKEN.currentFace.name}} to {{$INVESTIGATOR.currentFace.name}}."],
                                ["ATTACH_CARD", "$LEAD_INVESTIGATOR_TOKEN.id", "$INVESTIGATOR.id"]
                            ]
                        ]
                    ]
                ]
            ]
        },
        "DO_UPDATE_INVESTIGATOR_NAMES": {
            "args": [],
            "code": [
                ["FOR_EACH_VAL", "$PLAYER_I", "$PLAYER_ORDER", [
                    ["VAR", "$ALIAS_I", ["GET_ALIAS", "$PLAYER_I"]],
                    ["VAR", "$ALIAS_I", ["SUBSTRING", "$ALIAS_I", 7, ["SUBTRACT", ["LENGTH", "$ALIAS_I"], 8]]],
                    ["SET", "/groupById/{{$PLAYER_I}}Investigator/tableLabel", "$ALIAS_I"]
                ]]
            ]
        },
        "DO_APPEND_CARD_INFO": {
            "args": ["$TEXT"],
            "code": [
                ["UPDATE_VAR", "$MESSAGE", "{{$MESSAGE}}{{$SEPARATOR}}{{$TEXT}}"],
                ["UPDATE_VAR", "$SEPARATOR", ", "]
            ]
        },
        "DO_VIEW_CARD_INFO": {
            "args": ["$TARGET_CARD_ID"],
            "code": [
                ["VAR", "$TARGET_CARD", ["GET_CARD_AND_VALIDATE", "$TARGET_CARD_ID", "DO_VIEW_CARD_INFO.TARGET_CARD_ID"]],
                ["VAR", "$MESSAGE", "{{$TARGET_CARD.currentFace.name}}"],
                ["VAR", "$SEPARATOR", " is "],
                ["COND",
                    ["OR",
                        ["EQUAL", "$TARGET_CARD.cardOwner", null],
                        ["EQUAL", "$TARGET_CARD.cardOwner", ""]
                    ],
                    ["DO_APPEND_CARD_INFO", "not owned by anyone"],
                    ["EQUAL", "$TARGET_CARD.cardOwner", "shared"],
                    ["DO_APPEND_CARD_INFO", "owned by the scenario"],
                    ["TRUE"],
                    ["DO_APPEND_CARD_INFO", ["JOIN_STRING", "owned by ", ["GET_ALIAS", "$TARGET_CARD.cardOwner"]]]
                ],
                ["COND",
                    ["OR",
                        ["EQUAL", "$TARGET_CARD.controller", null],
                        ["EQUAL", "$TARGET_CARD.controller", ""]
                    ],
                    ["DO_APPEND_CARD_INFO", "not controlled by anyone"],
                    ["EQUAL", "$TARGET_CARD.controller", "shared"],
                    ["DO_APPEND_CARD_INFO", "controlled by the scenario"],
                    ["TRUE"],
                    ["DO_APPEND_CARD_INFO", ["JOIN_STRING", "controlled by ", ["GET_ALIAS", "$TARGET_CARD.controller"]]]
                ],
                ["COND",
                    ["AND",
                        ["NOT_EQUAL", "$TARGET_CARD.cardDeck", null],
                        ["NOT_EQUAL", "$TARGET_CARD.cardDeck", ""]
                    ],
                    ["DO_APPEND_CARD_INFO", ["JOIN_STRING", "having source in ", "$GROUP_BY_ID.{{$TARGET_CARD.cardDeck}}.label"]]
                ],
                ["COND",
                    ["EQUAL", "$TARGET_CARD.inPlay", true],
                    ["DO_APPEND_CARD_INFO", "in play"],
                    ["TRUE"],
                    ["DO_APPEND_CARD_INFO", "not in play"]
                ],
                ["LOG", "└── {{$MESSAGE}}."]
            ]
        },
        "GET_NEXT_ACTIVE_PLAYER": {
            "args": ["$TARGET_PLAYER"],
            "code": [
                ["VALIDATE_PLAYER", "$TARGET_PLAYER", "GET_NEXT_ACTIVE_PLAYER.TARGET_PLAYER"],
                ["VAR", "$NEXT_PLAYER", ["NEXT_PLAYER", "$TARGET_PLAYER"]],
                ["WHILE",
                    ["AND",
                        ["NOT_EQUAL", "$NEXT_PLAYER", "$TARGET_PLAYER"],
                        ["NOT_EQUAL", "$NEXT_PLAYER", "$GAME.firstPlayer"],
                        ["EQUAL", ["GET_PLAYER_ELIMINATED", "$NEXT_PLAYER"], true]
                    ],
                    ["UPDATE_VAR", "$NEXT_PLAYER", ["NEXT_PLAYER", "$NEXT_PLAYER"]]
                ],
                ["COND",
                    ["AND",
                        ["NOT_EQUAL", "$NEXT_PLAYER", "$TARGET_PLAYER"],
                        ["NOT_EQUAL", "$NEXT_PLAYER", "$GAME.firstPlayer"]
                    ],
                    "$NEXT_PLAYER",
                    ["TRUE"],
                    null
                ]
            ]
        },
        "PROMPT_NEXT_ACTIVE_PLAYER": {
            "args": ["$TARGET_PLAYER", "$PROMPT_NAME", "$FOLLOWUP_PROMPT"],
            "code": [
                ["VALIDATE_PLAYER", "$TARGET_PLAYER", "PROMPT_NEXT_ACTIVE_PLAYER.TARGET_PLAYER"],
                ["VALIDATE_NOT_EMPTY", "$PROMPT_NAME", "PROMPT_NEXT_ACTIVE_PLAYER.PROMPT_NAME"],
                ["VAR", "$NEXT_PLAYER", ["GET_NEXT_ACTIVE_PLAYER", "$TARGET_PLAYER"]],
                ["COND",
                    ["NOT_EQUAL", "$NEXT_PLAYER", null],
                    ["PROMPT", "$NEXT_PLAYER", "$PROMPT_NAME"],
                    ["NOT_EQUAL", "$FOLLOWUP_PROMPT", null],
                    ["PROMPT", "$GAME.firstPlayer", "$FOLLOWUP_PROMPT"],
                    ["TRUE"],
                    "$GAME"
                ]
            ]
        }
    },
    "labels": {
        "viewCardInfoMenu": {
            "English": "Info"
        }
    }
}