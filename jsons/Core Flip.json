{
    "actionLists": {
        "flipCard": [
            ["DO_FLIP_CARD", "$PLAYER_N", "$ACTIVE_CARD_ID", true, "$PLAYER_N"]
        ]
    },
    "functions": {
        "DO_FLIP_CARD": {
            "args": ["$TARGET_PLAYER", "$TARGET_CARD_ID", "$LOG_EVENT", "$ACTOR_PLAYER"],
            "code": [
                ["VAR", "$TARGET_CARD", "$CARD_BY_ID.$TARGET_CARD_ID"],
                ["COND",
                    ["NOT_EQUAL", "$TARGET_CARD", null],
                    [
                        ["VAR", "$TARGET_GROUP_ID", "$TARGET_CARD.groupId"],
                        ["VAR", "$TARGET_GROUP", "$GROUP_BY_ID.$TARGET_GROUP_ID"],
                        ["COND",
                            ["EQUAL", "$TARGET_CARD.currentFace.type", "MiniInvestigator"],
                            ["COND",
                                ["EQUAL", "$TARGET_CARD.currentSide", "A"],
                                ["DO_EXHAUST_CARD", "$TARGET_PLAYER", "$TARGET_CARD_ID", "$LOG_EVENT", "$ACTOR_PLAYER"],
                                ["TRUE"],
                                ["DO_READY_CARD", "$TARGET_PLAYER", "$TARGET_CARD_ID", "$LOG_EVENT", "$ACTOR_PLAYER"]
                            ],
                            ["AND",
                                ["EQUAL", "$TARGET_GROUP.groupType", "story"],
                                ["GREATER_THAN", ["LENGTH", "$TARGET_GROUP.stackIds"], 0],
                                ["EQUAL", "$TARGET_CARD_ID", ["GET_TOP_CARD_ID", "$TARGET_GROUP_ID"]]
                            ],
                            [
                                ["DO_LOG", "$LOG_EVENT", "$ACTOR_PLAYER", "$TARGET_PLAYER", "advance {{$TARGET_CARD.currentFace.name}}.", "advances {{$TARGET_CARD.currentFace.name}}."],
                                ["COND",
                                    ["EQUAL", "$TARGET_CARD.currentSide", "A"],
                                    ["DO_FLIP_FACEDOWN", "$TARGET_PLAYER", "$TARGET_CARD_ID", false, null],
                                    ["TRUE"],
                                    [
                                        ["COND",
                                            ["GREATER_THAN", ["LENGTH", "$TARGET_GROUP.stackIds"], 1],
                                            ["DO_MOVE_CARD", "$TARGET_PLAYER", "$TARGET_CARD_ID", "$TARGET_GROUP_ID", -1, false, null]
                                        ],
                                        ["DO_FLIP_FACEUP", "$TARGET_PLAYER", "$TARGET_CARD_ID", false, null]
                                    ]
                                ]
                            ],
                            ["TRUE"],
                            ["COND",
                                ["EQUAL", "$TARGET_CARD.currentSide", "A"],
                                ["DO_FLIP_FACEDOWN", "$TARGET_PLAYER", "$TARGET_CARD_ID", "$LOG_EVENT", "$ACTOR_PLAYER"],
                                ["TRUE"],
                                ["DO_FLIP_FACEUP", "$TARGET_PLAYER", "$TARGET_CARD_ID", "$LOG_EVENT", "$ACTOR_PLAYER"]
                            ]
                        ]
                    ]
                ]
            ]
        },
        "DO_FLIP_FACEDOWN": {
            "args": ["$TARGET_PLAYER", "$TARGET_CARD_ID", "$LOG_EVENT", "$ACTOR_PLAYER"],
            "code": [
                ["VAR", "$TARGET_CARD", "$CARD_BY_ID.$TARGET_CARD_ID"],
                ["COND",
                    ["AND",
                        ["NOT_EQUAL", "$TARGET_CARD", null],
                        ["EQUAL", "$TARGET_CARD.currentSide", "A"]
                    ],
                    [
                        ["DO_LOG", "$LOG_EVENT", "$ACTOR_PLAYER", "$TARGET_PLAYER", "flip {{$TARGET_CARD.currentFace.name}} facedown.", "flips {{$TARGET_CARD.currentFace.name}} facedown."],
                        ["SET", "/cardById/$TARGET_CARD_ID/currentSide", "B"]
                    ]
                ]
            ]
        },
        "DO_FLIP_FACEUP": {
            "args": ["$TARGET_PLAYER", "$TARGET_CARD_ID", "$LOG_EVENT", "$ACTOR_PLAYER"],
            "code": [
                ["VAR", "$TARGET_CARD", "$CARD_BY_ID.$TARGET_CARD_ID"],
                ["COND",
                    ["AND",
                        ["NOT_EQUAL", "$TARGET_CARD", null],
                        ["NOT_EQUAL", "$TARGET_CARD.currentSide", "A"]
                    ],
                    [
                        ["DO_LOG", "$LOG_EVENT", "$ACTOR_PLAYER", "$TARGET_PLAYER", "flip {{$TARGET_CARD.currentFace.name}} faceup.", "flips {{$TARGET_CARD.currentFace.name}} faceup."],
                        ["SET", "/cardById/$TARGET_CARD_ID/currentSide", "A"]
                    ]
                ]
            ]
        }
    },
    "labels": {
        "flipCard": {
            "English": "Flip"
        }
    }
}