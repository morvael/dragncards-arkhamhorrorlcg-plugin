{
    "actionLists": {
        "eliminateInvestigator": [
            ["VAR", "$INVESTIGATOR_CARD_ID", ["GET_INVESTIGATOR_CARD_ID", "$PLAYER_N"]],
            ["COND",
                ["AND",
                    ["NOT_EQUAL", "$INVESTIGATOR_CARD_ID", null],
                    ["EQUAL", "$GAME.arkhamScenarioInit", false],
                    ["NOT_EQUAL", "$PLAYER_DATA.$PLAYER_N.eliminated", true]
                ],
                ["PROMPT", "$PLAYER_N", "eliminateInvestigator", "$INVESTIGATOR_CARD_ID"],
                ["TRUE"],
                ["LOG", "└── You cannot eliminate your Investigator, {{$ALIAS_N}}."]
            ]
        ],
        "investigatorTurn": [
            ["COND",
                ["EQUAL", "$GAME.arkhamActiveInvestigator", null],
                ["DO_START_INVESTIGATOR_TURN", "$PLAYER_N", true, true, "$PLAYER_N"],
                ["EQUAL", "$GAME.arkhamActiveInvestigator", "$PLAYER_N"],
                ["DO_END_INVESTIGATOR_TURN", true, true, "$PLAYER_N"]
            ]
        ]
    },
    "functions": {
        "DO_ELIMINATE_INVESTIGATOR": {
            "args": ["$INVESTIGATOR_CARD_ID", "$REASON"],
            "code": [
                ["VAR", "$INVESTIGATOR_CARD", ["GET_CARD_AND_VALIDATE", "$INVESTIGATOR_CARD_ID", "DO_ELIMINATE_INVESTIGATOR.INVESTIGATOR_CARD_ID"]],
                ["VALIDATE_EQUAL", "$INVESTIGATOR_CARD.currentFace.type", "Investigator", "DO_ELIMINATE_INVESTIGATOR.INVESTIGATOR_CARD.currentFace.type"],
                ["VALIDATE_NOT_EMPTY", "$REASON", "DO_ELIMINATE_INVESTIGATOR.REASON"],
                ["VAR", "$ELIMINATED_PLAYER", "$INVESTIGATOR_CARD.cardOwner"],
                ["VAR", "$ELIMINATED_ALIAS", ["GET_ALIAS", "$ELIMINATED_PLAYER"]],
                ["LOG", "{{$ELIMINATED_ALIAS}}'s {{$INVESTIGATOR_CARD.currentFace.name}} {{$REASON}}."],
                ["COND",
                    ["EQUAL", "$GAME.firstPlayer", "$ELIMINATED_PLAYER"],
                    [
                        ["VAR", "$POSSIBLE_LEADS", ["LIST"]],
                        ["FOR_EACH_VAL", "$PLAYER_I", "$PLAYER_ORDER", [
                            ["COND",
                                ["AND",
                                    ["NOT_EQUAL", "$PLAYER_I", "$ELIMINATED_PLAYER"],
                                    ["NOT_EQUAL", "$PLAYER_DATA.$PLAYER_I.eliminated", true]
                                ],
                                ["UPDATE_VAR", "$POSSIBLE_LEADS", ["APPEND", "$POSSIBLE_LEADS", "$PLAYER_I"]]
                            ]
                        ]],
                        ["COND",
                            ["GREATER_THAN", ["LENGTH", "$POSSIBLE_LEADS"], 1],
                            [
                                ["PROMPT", "$ELIMINATED_PLAYER", "chooseNewLeadInvestigator"],
                                ["FOR_EACH_VAL", "$PLAYER_I", "$POSSIBLE_LEADS", [
                                    ["VAR", "$ALIAS_I", ["GET_ALIAS", "$PLAYER_I"]],
                                    ["VAR", "$LETTER", ["SUBSTRING", "$PLAYER_I", 6, 1]],
                                    ["PROMPT_ADD_OPTION", "$ELIMINATED_PLAYER", "$ALIAS_I", "{{$LETTER}}", ["LIST", "DO_ELIMINATE_INVESTIGATOR_FINAL", "{{$ELIMINATED_PLAYER}}", "{{$PLAYER_I}}"]]
                                ]]
                            ],
                            ["EQUAL", ["LENGTH", "$POSSIBLE_LEADS"], 1],
                            ["DO_ELIMINATE_INVESTIGATOR_FINAL", "$ELIMINATED_PLAYER", "$POSSIBLE_LEADS.[0]"],
                            ["TRUE"],
                            [
                                ["LOG", "└── Scenario ends, as there are no remaining players!"],
                                ["DO_ELIMINATE_INVESTIGATOR_FINAL", "$ELIMINATED_PLAYER", null]
                            ]
                        ]
                    ],
                    ["TRUE"],
                    ["DO_ELIMINATE_INVESTIGATOR_FINAL", "$ELIMINATED_PLAYER", "$GAME.firstPlayer"]
                ]
            ]
        },
        "DO_ELIMINATE_INVESTIGATOR_FINAL": {
            "args": ["$ELIMINATED_PLAYER", "$NEW_LEAD_PLAYER"],
            "code": [
                ["VALIDATE_PLAYER", "$ELIMINATED_PLAYER", "DO_ELIMINATE_INVESTIGATOR_FINAL.ELIMINATED_PLAYER"],
                ["COND",
                    ["EQUAL", "$NEW_LEAD_PLAYER", null],
                    [
                        ["VAR", "$LEAD_INVESTIGATOR_TOKEN_CARD_ID", ["GET_LEAD_INVESTIGATOR_TOKEN_CARD_ID"]],
                        ["DO_LOG", true, null, "$ELIMINATED_PLAYER", "move {{$CARD_BY_ID.$LEAD_INVESTIGATOR_TOKEN_CARD_ID.currentFace.name}} to {{$GROUP_BY_ID.sharedTokens.label}}.", "moves {{$CARD_BY_ID.$LEAD_INVESTIGATOR_TOKEN_CARD_ID.currentFace.name}} to {{$GROUP_BY_ID.sharedTokens.label}}."],
                        ["MOVE_CARD", "$LEAD_INVESTIGATOR_TOKEN_CARD_ID", "sharedTokens", -1]
                    ],
                    ["NOT_EQUAL", "$NEW_LEAD_PLAYER", "$GAME.firstPlayer"],
                    [
                        ["VAR", "$NEW_LEAD_INVESTIGATOR_CARD_ID", ["GET_INVESTIGATOR_CARD_ID", "$NEW_LEAD_PLAYER"]],
                        ["LOG", "└── ", ["GET_ALIAS", "$NEW_LEAD_PLAYER"], "'s {{$CARD_BY_ID.$NEW_LEAD_INVESTIGATOR_CARD_ID.currentFace.name}} is the new lead investigator."],
                        ["SET", "/firstPlayer", "$NEW_LEAD_PLAYER"]
                    ]
                ],
                ["COND",
                    ["EQUAL", "$ELIMINATED_PLAYER", "$GAME.arkhamActiveInvestigator"],
                    ["DO_END_INVESTIGATOR_TURN", false, true, null]
                ],
                ["VAR", "$INVESTIGATOR_CARD_ID", ["GET_INVESTIGATOR_CARD_ID", "$ELIMINATED_PLAYER"]],
                ["COND",
                    ["NOT_EQUAL", "$INVESTIGATOR_CARD_ID", null],
                    [
                        ["SET", "/cardById/$INVESTIGATOR_CARD_ID/tokens/resource", 0],
                        ["COND",
                            ["GREATER_THAN", "$CARD_BY_ID.$INVESTIGATOR_CARD_ID.tokens.clue", 0],
                            ["LOG", "└── Place all {{$CARD_BY_ID.$INVESTIGATOR_CARD_ID.currentFace.name}}'s clues at the location they were at."]
                        ],
                        ["SET", "/cardById/$INVESTIGATOR_CARD_ID/tokens/doom", 0],
                        ["SET", "/cardById/$INVESTIGATOR_CARD_ID/tokens/damage", 0],
                        ["SET", "/cardById/$INVESTIGATOR_CARD_ID/tokens/horror", 0],
                        ["SET", "/cardById/$INVESTIGATOR_CARD_ID/tokens/freeze", 0],
                        ["SET", "/cardById/$INVESTIGATOR_CARD_ID/currentSide", "B"]
                    ]
                ],
                ["VAR", "$SELECTED_CARDS", ["FILTER_CARDS", "$CARD", ["AND",
                    ["EQUAL", "$CARD.controller", "$ELIMINATED_PLAYER"],
                    ["OR",
                        ["IN_STRING", "$GROUP_BY_ID.{{$CARD.groupId}}.groupType", "inPlay"],
                        ["IN_STRING", "$GROUP_BY_ID.{{$CARD.groupId}}.groupType", "story"],
                        ["IN_STRING", "$GROUP_BY_ID.{{$CARD.groupId}}.groupType", "outOfPlay"]
                    ],
                    ["EQUAL", "$CARD.sides.B.databaseId", null],
                    ["EQUAL", "$CARD.sides.B.name", "Player Card"],
                    ["EQUAL", "$CARD.cardIndex", 0],
                    ["GREATER_THAN", ["GET_ATTACHED_CARDS_COUNT", "$CARD.id"], 0]
                ]]],
                ["FOR_EACH_VAL", "$CARD", "$SELECTED_CARDS", [
                    ["DO_FORCE_DISCARD_ALL_ATTACHED_CARDS", "$ELIMINATED_PLAYER", "$CARD.id", false, null]
                ]],
                ["VAR", "$THREAT_ID", ["GET_CONTROLLER_THREAT", "$ELIMINATED_PLAYER"]],
                ["VAR", "$SELECTED_CARDS", ["FILTER_CARDS", "$CARD", ["AND",
                    ["EQUAL", "$CARD.groupId", "$THREAT_ID"],
                    ["NOT_EQUAL", "$CARD.currentFace.type", "Enemy"]
                ]]],
                ["FOR_EACH_VAL", "$CARD", "$SELECTED_CARDS", [
                    ["DO_DISCARD_CARD", "$ELIMINATED_PLAYER", "$CARD.id", false, null]
                ]],
                ["VAR", "$SELECTED_CARDS", ["FILTER_CARDS", "$CARD", ["AND",
                    ["EQUAL", "$CARD.groupId", "$THREAT_ID"],
                    ["EQUAL", "$CARD.currentFace.type", "Enemy"]
                ]]],
                ["COND",
                    ["GREATER_THAN", ["LENGTH", "$SELECTED_CARDS"], 0],
                    ["LOG", "└── Place all {{$CARD_BY_ID.$INVESTIGATOR_CARD_ID.currentFace.name}}'s enemies from their threat area at the location they were at."]
                ],
                ["VAR", "$REMOVED_ID", ["GET_CONTROLLER_REMOVED", "$ELIMINATED_PLAYER"]],
                ["VAR", "$EXILED_ID", ["GET_CONTROLLER_EXILED", "$ELIMINATED_PLAYER"]],
                ["VAR", "$SELECTED_CARDS", ["FILTER_CARDS", "$CARD", ["AND",
                    ["EQUAL", "$CARD.controller", "$ELIMINATED_PLAYER"],
                    ["NOT_EQUAL", "$CARD.groupId", "$REMOVED_ID"],
                    ["NOT_EQUAL", "$CARD.groupId", "$EXILED_ID"],
                    ["EQUAL", "$CARD.sides.B.databaseId", null],
                    ["EQUAL", "$CARD.sides.B.name", "Player Card"]
                ]]],
                ["FOR_EACH_VAL", "$CARD", "$SELECTED_CARDS", [
                    ["MOVE_CARD", "$CARD.id", "$REMOVED_ID", -1]
                ]],
                ["SET", "/playerData/$ELIMINATED_PLAYER/resources", 0],
                ["SET", "/playerData/$ELIMINATED_PLAYER/eliminated", true]
            ]
        },
        "DO_END_INVESTIGATOR_TURN": {
            "args": ["$SET_STEP", "$LOG_EVENT", "$ACTOR_PLAYER"],
            "code": [
                ["VAR", "$TARGET_PLAYER", "$GAME.arkhamActiveInvestigator"],
                ["COND",
                    ["NOT_EQUAL", "$TARGET_PLAYER", null],
                    [
                        ["VAR", "$INVESTIGATOR_CARD_ID", ["GET_INVESTIGATOR_CARD_ID", "$TARGET_PLAYER"]],
                        ["VAR", "$MINI_INVESTIGATOR_CARD_ID", ["GET_MINI_INVESTIGATOR_CARD_ID", "$TARGET_PLAYER"]],
                        ["COND",
                            ["AND",
                                ["NOT_EQUAL", "$INVESTIGATOR_CARD_ID", null],
                                ["NOT_EQUAL", "$MINI_INVESTIGATOR_CARD_ID", null]
                            ],
                            [
                                ["VAR", "$INVESTIGATOR_CARD_NAME", "$CARD_BY_ID.$INVESTIGATOR_CARD_ID.currentFace.name"],
                                ["DO_LOG", "$LOG_EVENT", "$ACTOR_PLAYER", "$TARGET_PLAYER", "end {{$INVESTIGATOR_CARD_NAME}}'s turn.", "ends {{$INVESTIGATOR_CARD_NAME}}'s turn."],
                                ["DO_EXHAUST_CARD", "$TARGET_PLAYER", "$MINI_INVESTIGATOR_CARD_ID", true, null],
                                ["SET", "/arkhamActiveInvestigator", null],
                                ["UNSET", "/cardById/$INVESTIGATOR_CARD_ID/borderColor"],
                                ["UNSET", "/cardById/$MINI_INVESTIGATOR_CARD_ID/borderColor"],
                                ["COND",
                                    ["EQUAL", "$SET_STEP", true],
                                    ["SET", "/stepId", "I2.2"]
                                ]
                            ]
                        ]
                    ]
                ]
            ]
        },
        "DO_START_INVESTIGATOR_TURN": {
            "args": ["$TARGET_PLAYER", "$SET_STEP", "$LOG_EVENT", "$ACTOR_PLAYER"],
            "code": [
                ["COND",
                    ["AND",
                        ["NOT_EQUAL", "$TARGET_PLAYER", null],
                        ["NOT_EQUAL", "$PLAYER_DATA.$TARGET_PLAYER.eliminated", true]
                    ],
                    [
                        ["VAR", "$INVESTIGATOR_CARD_ID", ["GET_INVESTIGATOR_CARD_ID", "$TARGET_PLAYER"]],
                        ["VAR", "$MINI_INVESTIGATOR_CARD_ID", ["GET_MINI_INVESTIGATOR_CARD_ID", "$TARGET_PLAYER"]],
                        ["COND",
                            ["AND",
                                ["NOT_EQUAL", "$INVESTIGATOR_CARD_ID", null],
                                ["NOT_EQUAL", "$MINI_INVESTIGATOR_CARD_ID", null]
                            ],
                            [
                                ["DO_END_INVESTIGATOR_TURN", "$SET_STEP", "$LOG_EVENT", "$ACTOR_PLAYER"],
                                ["VAR", "$INVESTIGATOR_CARD_NAME", "$CARD_BY_ID.$INVESTIGATOR_CARD_ID.currentFace.name"],
                                ["DO_LOG", "$LOG_EVENT", "$ACTOR_PLAYER", "$TARGET_PLAYER", "start {{$INVESTIGATOR_CARD_NAME}}'s turn.", "starts {{$INVESTIGATOR_CARD_NAME}}'s turn."],
                                ["DO_READY_CARD", "$TARGET_PLAYER", "$MINI_INVESTIGATOR_CARD_ID", true, null],
                                ["SET", "/arkhamActiveInvestigator", "$TARGET_PLAYER"],
                                ["SET", "/cardById/$INVESTIGATOR_CARD_ID/borderColor", "HotPink"],
                                ["SET", "/cardById/$MINI_INVESTIGATOR_CARD_ID/borderColor", "HotPink"],
                                ["COND",
                                    ["EQUAL", "$SET_STEP", true],
                                    ["SET", "/stepId", "I2"]
                                ]
                            ]
                        ]
                    ]
                ]
            ]
        }
    },
    "prompts": {
        "eliminateInvestigator": {
            "args": ["$INVESTIGATOR_CARD_ID"],
            "message": "Select fate of eliminated {{$CARD_BY_ID.$INVESTIGATOR_CARD_ID.currentFace.name}}.",
            "options": [
                {
                    "label": "Resigned",
                    "hotkey": "R",
                    "code": [
                        ["DO_ELIMINATE_INVESTIGATOR", "$INVESTIGATOR_CARD_ID", "resigns"]
                    ]
                },
                {
                    "label": "Defated by damage",
                    "hotkey": "D",
                    "code": [
                        ["DO_ELIMINATE_INVESTIGATOR", "$INVESTIGATOR_CARD_ID", "is defated by damage"]
                    ]
                },
                {
                    "label": "Defated by horror",
                    "hotkey": "H",
                    "code": [
                        ["DO_ELIMINATE_INVESTIGATOR", "$INVESTIGATOR_CARD_ID", "is defated by horror"]
                    ]
                },
                {
                    "label": "Other",
                    "hotkey": "O",
                    "code": [
                        ["DO_ELIMINATE_INVESTIGATOR", "$INVESTIGATOR_CARD_ID", "is eliminated"]
                    ]
                },
                {
                    "label": "Cancel",
                    "hotkey": "X"
                }
            ]
        },
        "chooseNewLeadInvestigator": {
            "args": [],
            "message": "Choose a new lead investigator.",
            "options": [

             ]
        }
    },
    "labels": {
        "eliminateInvestigatorMenu": {
            "English": "Eliminate your Investigator"
        },
        "investigatorTurn": {
            "English": "Start / End your turn"
        }
    }
}