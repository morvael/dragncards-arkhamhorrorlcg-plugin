{
    "actionLists": {
        "attachDetachCard": [
            ["COND",
                ["GREATER_THAN", "$ACTIVE_CARD.cardIndex", 0],
                ["COND",
                    ["OR",
                        ["EQUAL", "$ACTIVE_FACE.type", "FirstInvestigatorToken"]
                    ],
                    ["LOG", "{{$ACTIVE_FACE.name}} cannot be detached from {{$ACTIVE_CARD.parentCard.currentFace.name}}, {{$ALIAS_N}}."],
                    ["TRUE"],
                    [
                        ["LOG", "{{$ALIAS_N}} detaches {{$ACTIVE_FACE.name}} from {{$ACTIVE_CARD.parentCard.currentFace.name}}."],
                        ["MOVE_CARD", "$ACTIVE_CARD_ID", "$ACTIVE_CARD.groupId", ["ADD", "$ACTIVE_CARD.stackIndex", 1], 0, {"allowFlip": false}]
                    ]
                ],
                ["TRUE"],
                ["COND",
                    ["EQUAL", "$GAME.playerData.{{$PLAYER_N}}.cardToBeAttached", null],
                    ["COND",
                        ["OR",
                            ["EQUAL", "$ACTIVE_FACE.type", "Investigator"]
                        ],
                        ["LOG", "{{$ACTIVE_FACE.name}} cannot be attached, {{$ALIAS_N}}."],
                        ["TRUE"],
                        [
                            ["LOG", "{{$ALIAS_N}} will attach {{$ACTIVE_FACE.name}}."],
                            ["SET", "/playerData/{{$PLAYER_N}}/cardToBeAttached", "$ACTIVE_CARD"],
                            ["SET", "/cardById/{{$ACTIVE_CARD_ID}}/borderColor", "LightSkyBlue"]
                        ]
                    ],
                    ["TRUE"],
                    [
                        ["VAR", "$ATTACHED_CARD", "$GAME.playerData.{{$PLAYER_N}}.cardToBeAttached"],
                        ["COND",
                            ["EQUAL", "$ATTACHED_CARD.id", "$ACTIVE_CARD_ID"],
                            ["LOG", "{{$ATTACHED_CARD.currentFace.name}} cannot be attached to {{$ACTIVE_FACE.name}}, {{$ALIAS_N}}."],
                            ["TRUE"],
                            [
                                ["LOG", "{{$ALIAS_N}} attaches {{$ATTACHED_CARD.currentFace.name}} to {{$ACTIVE_FACE.name}}."],
                                ["ATTACH_CARD", "$ATTACHED_CARD.id", "$ACTIVE_CARD_ID"]
                            ]
                        ],
                        ["UNSET", "/playerData/{{$PLAYER_N}}/cardToBeAttached"],
                        ["UNSET", "/cardById/{{$ATTACHED_CARD.id}}/borderColor"]
                    ]
                ]
            ]
        ]
    },
    "labels": {
        "attachDetachCard": {
            "English": "Attach / Detach"
        }
    }
}