{
    "actionLists": {
        "discardCard": [
            ["COND",
                ["GREATER_THAN", ["GET_DISCARD_CARD_MODE", "$PLAYER_N", "$ACTIVE_CARD_ID", "$PLAYER_N"], 0],
                ["DO_DISCARD_CARD", "$PLAYER_N", "$ACTIVE_CARD_ID", true, "$PLAYER_N"],
                ["TRUE"],
                ["LOG", "└── You cannot discard {{$ACTIVE_FACE.name}}, {{$ALIAS_N}}."]
            ]
        ],
        "discardVoid": [
            ["VAR", "$SELECTED_VOID", ["FILTER_CARDS", "$CARD", ["AND",
                ["EQUAL", "$CARD.groupId", "sharedVoid"],
                ["EQUAL", "$CARD.cardIndex", 0]
            ]]],
            ["COND",
                ["GREATER_THAN", ["LENGTH", "$SELECTED_VOID"], 0],
                [
                    ["DO_LOG", true, "$PLAYER_N", "$PLAYER_N", "discard Limbo.", "discards Limbo."],
                    ["FOR_EACH_VAL", "$CARD", "$SELECTED_VOID", [
                        ["DO_DISCARD_CARD", ["GET_PLAYER_CONTROLLER", "$PLAYER_N", "$CARD.id"], "$CARD.id", true, null]
                    ]]
                ],
                ["TRUE"],
                ["LOG", "└── You cannot discard Limbo, {{$ALIAS_N}}."]
            ]
        ],
        "discardRandomCardsFromHand": [
            ["COND",
                ["CAN_DISCARD_RANDOM_CARDS_FROM_HAND", "$PLAYER_N", "$ACTIVE_GROUP_ID", "$PLAYER_N"],
                ["DO_DISCARD_RANDOM_CARDS_FROM_HAND", "$PLAYER_N", "$ACTIVE_GROUP_ID", true, "$PLAYER_N"],
                ["TRUE"],
                ["LOG", "└── You cannot discard N random cards from {{$ACTIVE_GROUP.label}}, {{$ALIAS_N}}."]
            ]
        ],
        "selectRandomCardsInHand": [
            ["COND",
                ["CAN_SELECT_RANDOM_CARDS_IN_HAND", "$PLAYER_N", "$ACTIVE_GROUP_ID", "$PLAYER_N"],
                ["DO_SELECT_RANDOM_CARDS_IN_HAND", "$PLAYER_N", "$ACTIVE_GROUP_ID", true, "$PLAYER_N"],
                ["TRUE"],
                ["LOG", "└── You cannot target N random cards in {{$ACTIVE_GROUP.label}}, {{$ALIAS_N}}."]
            ]
        ]
    },
    "functions": {
        "GET_DISCARD_CARD_MODE": {
            "args": ["$TARGET_PLAYER", "$TARGET_CARD_ID", "$ACTOR_PLAYER"],
            "code": [
                ["VALIDATE_PLAYER", "$TARGET_PLAYER", "GET_DISCARD_CARD_MODE.TARGET_PLAYER"],
                ["VAR", "$TARGET_CARD", ["GET_CARD_AND_VALIDATE", "$TARGET_CARD_ID", "GET_DISCARD_CARD_MODE.TARGET_CARD_ID"]],
                ["COND",
                    ["AND",
                        ["IN_STRING", "$TARGET_CARD.groupId", "Deck"],
                        ["EQUAL", ["IN_STRING", "$TARGET_CARD.groupId", "SideDeck"], false]
                    ],
                    1,
                    ["AND",
                        ["NOT_EQUAL", "$TARGET_CARD.groupId", "sharedChaosBag"],
                        ["EQUAL", "$TARGET_CARD.currentFace.type", "ChaosToken"]
                    ],
                    2,
                    ["AND",
                        ["NOT_EQUAL", "$TARGET_CARD.groupId", "sharedTokens"],
                        ["OR",
                            ["EQUAL", "$TARGET_CARD.currentFace.type", "KeyToken"],
                            ["EQUAL", "$TARGET_CARD.currentFace.type", "FloodedToken"],
                            ["EQUAL", "$TARGET_CARD.currentFace.type", "SealToken"]
                        ]
                    ],
                    3,
                    ["AND",
                        ["EQUAL", "$TARGET_CARD.inHand", true],
                        ["IN_STRING", "$TARGET_CARD.groupId", "$TARGET_PLAYER"],
                        ["OR",
                            ["NOT_EQUAL", "$TARGET_CARD.sides.A.victoryPoints", null],
                            ["NOT_EQUAL", "$TARGET_CARD.sides.A.vengeance", null],
                            ["EQUAL", "$TARGET_CARD.sides.B.name", "Encounter Card"],
                            ["EQUAL", "$TARGET_CARD.sides.B.name", "Player Card"],
                            ["NOT_EQUAL", "$TARGET_CARD.cardDiscard", ""]
                        ]
                    ],
                    4,
                    ["AND",
                        ["OR",
                            ["EQUAL", "$TARGET_CARD.inPlay", true],
                            ["EQUAL", "$GROUP_BY_ID.{{$TARGET_CARD.groupId}}.canHaveAttachments", true]
                        ],
                        ["OR",
                            ["EQUAL", "$TARGET_CARD.currentFace.type", "Asset"],
                            ["EQUAL", "$TARGET_CARD.currentFace.type", "Treachery"],
                            ["EQUAL", "$TARGET_CARD.currentFace.type", "Event"],
                            ["EQUAL", "$TARGET_CARD.currentFace.type", "Skill"],
                            ["EQUAL", "$TARGET_CARD.currentFace.type", "Enemy"],
                            ["EQUAL", "$TARGET_CARD.currentFace.type", "MiniConcealed"]
                        ],
                        ["NOT_EQUAL", "$TARGET_CARD.currentFace.permanent", true],
                        ["OR",
                            ["NOT_EQUAL", "$TARGET_CARD.currentFace.victoryPoints", null],
                            ["NOT_EQUAL", "$TARGET_CARD.currentFace.vengeance", null],
                            ["EQUAL", "$TARGET_CARD.sides.B.name", "Encounter Card"],
                            ["AND",
                                ["EQUAL", "$TARGET_CARD.sides.B.name", "Player Card"],
                                ["NOT_EQUAL", "$TARGET_CARD.cardOwner", "shared"]
                            ],
                            ["NOT_EQUAL", "$TARGET_CARD.cardDiscard", ""]
                        ]
                    ],
                    5,
                    ["TRUE"],
                    0
                ]
            ]
        },
        "DO_DISCARD_CARD": {
            "args": ["$TARGET_PLAYER", "$TARGET_CARD_ID", "$LOG_EVENT", "$ACTOR_PLAYER"],
            "code": [
                ["VALIDATE_PLAYER", "$TARGET_PLAYER", "DO_DISCARD_CARD.TARGET_PLAYER"],
                ["VAR", "$TARGET_CARD", ["GET_CARD_AND_VALIDATE", "$TARGET_CARD_ID", "DO_DISCARD_CARD.TARGET_CARD_ID"]],
                ["VAR", "$TARGET_GROUP", ["GET_GROUP_AND_VALIDATE", "$TARGET_CARD.groupId", "DO_DISCARD_CARD.TARGET_CARD.groupId"]],
                ["VALIDATE_BOOLEAN", "$LOG_EVENT", "DO_DISCARD_CARD.LOG_EVENT"],
                ["VAR", "$DISCARD_CARD_MODE", ["GET_DISCARD_CARD_MODE", "$TARGET_PLAYER", "$TARGET_CARD_ID", "$ACTOR_PLAYER"]],
                ["COND",
                    ["EQUAL", "$DISCARD_CARD_MODE", 1],
                    [
                        ["DO_LOG", "$LOG_EVENT", "$ACTOR_PLAYER", "$TARGET_PLAYER", "discard {{$TARGET_CARD.sides.A.name}} from the top of {{$TARGET_GROUP.label}}.", "discards {{$TARGET_CARD.sides.A.name}} from the top of {{$TARGET_GROUP.label}}."],
                        ["MOVE_CARD", "$TARGET_CARD_ID", ["GET_PAIRED_GROUP_ID", "$TARGET_GROUP.id"], 0, 0]
                    ],
                    ["EQUAL", "$DISCARD_CARD_MODE", 2],
                    ["COND",
                        ["OR",
                            ["EQUAL", "$TARGET_CARD.currentFace.name", "Bless"],
                            ["EQUAL", "$TARGET_CARD.currentFace.name", "Curse"]
                        ],
                        [
                            ["DO_LOG", "$LOG_EVENT", "$ACTOR_PLAYER", "$TARGET_PLAYER", "remove {{$TARGET_CARD.currentFace.name}} Chaos Token from the game.", "removes {{$TARGET_CARD.currentFace.name}} Chaos Token from the game."],
                            ["DELETE_CARD", "$TARGET_CARD_ID"]
                        ],
                        ["TRUE"],
                        [
                            ["DO_LOG", "$LOG_EVENT", "$ACTOR_PLAYER", "$TARGET_PLAYER", "return {{$TARGET_CARD.currentFace.name}} Chaos Token to the Chaos Bag.", "returns {{$TARGET_CARD.currentFace.name}} Chaos Token to the Chaos Bag."],
                            ["MOVE_CARD", "$TARGET_CARD_ID", "sharedChaosBag", -1]
                        ]
                    ],
                    ["EQUAL", "$DISCARD_CARD_MODE", 3],
                    [
                        ["DO_LOG", "$LOG_EVENT", "$ACTOR_PLAYER", "$TARGET_PLAYER", "remove {{$TARGET_CARD.currentFace.name}} Token.", "removes {{$TARGET_CARD.currentFace.name}} Token."],
                        ["MOVE_CARD", "$TARGET_CARD_ID", "sharedTokens", -1]
                    ],
                    ["EQUAL", "$DISCARD_CARD_MODE", 4],
                    ["COND",
                        ["OR",
                            ["NOT_EQUAL", "$TARGET_CARD.sides.A.victoryPoints", null],
                            ["NOT_EQUAL", "$TARGET_CARD.sides.A.vengeance", null]
                        ],
                        ["COND",
                            ["OR",
                                ["EQUAL", "$TARGET_CARD.sides.B.name", "Encounter Card"],
                                ["EQUAL", "$TARGET_CARD.sides.B.name", "Player Card"],
                                ["NOT_EQUAL", "$TARGET_CARD.cardDiscard", ""]
                            ],
                            ["PROMPT", "$TARGET_PLAYER", "victoryOrDiscardHand", "$TARGET_CARD_ID", "$LOG_EVENT", "$ACTOR_PLAYER"],
                            ["TRUE"],
                            [
                                ["DO_LOG", "$LOG_EVENT", "$ACTOR_PLAYER", "$TARGET_PLAYER", "move {{$TARGET_CARD.sides.A.name}} from hand to the Victory Display.", "moves {{$TARGET_CARD.sides.A.name}} from hand to the Victory Display."],
                                ["MOVE_CARD", "$TARGET_CARD_ID", "sharedVictoryDisplay", -1]
                            ]
                        ],
                        ["TRUE"],
                        ["DO_DISCARD_CARD_FINAL", "$TARGET_PLAYER", "$TARGET_CARD_ID", " from hand", "$LOG_EVENT", "$ACTOR_PLAYER"]
                    ],
                    ["EQUAL", "$DISCARD_CARD_MODE", 5],
                    ["COND",
                        ["OR",
                            ["NOT_EQUAL", "$TARGET_CARD.currentFace.victoryPoints", null],
                            ["NOT_EQUAL", "$TARGET_CARD.currentFace.vengeance", null]
                        ],
                        ["COND",
                            ["OR",
                                ["EQUAL", "$TARGET_CARD.sides.B.name", "Encounter Card"],
                                ["AND",
                                    ["EQUAL", "$TARGET_CARD.sides.B.name", "Player Card"],
                                    ["NOT_EQUAL", "$TARGET_CARD.cardOwner", "shared"]
                                ],
                                ["NOT_EQUAL", "$TARGET_CARD.cardDiscard", ""]
                            ],
                            ["PROMPT", "$TARGET_PLAYER", "victoryOrDiscardPlay", "$TARGET_CARD_ID", "$LOG_EVENT", "$ACTOR_PLAYER"],
                            ["TRUE"],
                            [
                                ["DO_LOG", "$LOG_EVENT", "$ACTOR_PLAYER", "$TARGET_PLAYER", "move {{$TARGET_CARD.currentFace.name}} to the Victory Display.", "moves {{$TARGET_CARD.currentFace.name}} to the Victory Display."],
                                ["DO_FORCE_DISCARD_ALL_ATTACHED_CARDS", "$TARGET_PLAYER", "$TARGET_CARD_ID", "$LOG_EVENT", null],
                                ["MOVE_CARD", "$TARGET_CARD_ID", "sharedVictoryDisplay", -1]
                            ]
                        ],
                        ["TRUE"],
                        ["DO_DISCARD_CARD_FINAL", "$TARGET_PLAYER", "$TARGET_CARD_ID", "", "$LOG_EVENT", "$ACTOR_PLAYER"]
                    ]
                ]
            ]
        },
        "DO_DISCARD_CARD_FINAL": {
            "args": ["$TARGET_PLAYER", "$TARGET_CARD_ID", "$SUFFIX", "$LOG_EVENT", "$ACTOR_PLAYER"],
            "code": [
                ["VALIDATE_PLAYER", "$TARGET_PLAYER", "DO_DISCARD_CARD_FINAL.TARGET_PLAYER"],
                ["VAR", "$TARGET_CARD", ["GET_CARD_AND_VALIDATE", "$TARGET_CARD_ID", "DO_DISCARD_CARD_FINAL.TARGET_CARD_ID"]],
                ["VALIDATE_BOOLEAN", "$LOG_EVENT", "DO_DISCARD_CARD_FINAL.LOG_EVENT"],
                ["VAR", "$TARGET_NAME", "$TARGET_CARD.currentFace.name"],
                ["COND",
                    ["EQUAL", "$SUFFIX", " from hand"],
                    ["UPDATE_VAR", "$TARGET_NAME", "$TARGET_CARD.sides.A.name"]
                ],
                ["COND",
                    ["AND",
                        ["NOT_EQUAL", "$TARGET_CARD.cardDiscard", ""],
                        ["EQUAL", "$TARGET_CARD.discardToOther", true]
                    ],
                    [
                        ["VAR", "$DISCARD_GROUP", ["GET_GROUP_AND_VALIDATE", "$TARGET_CARD.cardDiscard", "DO_DISCARD_CARD_FINAL.TARGET_CARD.cardDiscard"]],
                        ["DO_LOG", "$LOG_EVENT", "$ACTOR_PLAYER", "$TARGET_PLAYER", "discard {{$TARGET_NAME}}{{$SUFFIX}} to {{$DISCARD_GROUP.label}}.", "discards {{$TARGET_NAME}}{{$SUFFIX}} to {{$DISCARD_GROUP.label}}."],
                        ["DO_FORCE_DISCARD_ALL_ATTACHED_CARDS", "$TARGET_PLAYER", "$TARGET_CARD_ID", "$LOG_EVENT", null],
                        ["MOVE_CARD", "$TARGET_CARD_ID", "$TARGET_CARD.cardDiscard", 0, 0]
                    ],
                    ["EQUAL", "$TARGET_CARD.sides.B.name", "Encounter Card"],
                    [
                        ["DO_LOG", "$LOG_EVENT", "$ACTOR_PLAYER", "$TARGET_PLAYER", "discard {{$TARGET_NAME}}{{$SUFFIX}}.", "discards {{$TARGET_NAME}}{{$SUFFIX}}."],
                        ["DO_FORCE_DISCARD_ALL_ATTACHED_CARDS", "$TARGET_PLAYER", "$TARGET_CARD_ID", "$LOG_EVENT", null],
                        ["MOVE_CARD", "$TARGET_CARD_ID", "sharedEncounterDiscard", 0, 0]
                    ],
                    ["AND",
                        ["EQUAL", "$TARGET_CARD.sides.B.name", "Player Card"],
                        ["NOT_EQUAL", "$TARGET_CARD.cardOwner", "shared"]
                    ],
                    ["COND",
                        ["EQUAL", ["GET_PLAYER_ELIMINATED", "$TARGET_CARD.cardOwner"], true],
                        [
                            ["DO_LOG", "$LOG_EVENT", "$ACTOR_PLAYER", "$TARGET_PLAYER", "remove {{$TARGET_NAME}}{{$SUFFIX}} from the game.", "removes {{$TARGET_NAME}}{{$SUFFIX}} from the game."],
                            ["DO_FORCE_DISCARD_ALL_ATTACHED_CARDS", "$TARGET_PLAYER", "$TARGET_CARD_ID", "$LOG_EVENT", null],
                            ["MOVE_CARD", "$TARGET_CARD_ID", ["GET_CONTROLLER_REMOVED", "$TARGET_CARD.cardOwner"], -1]
                        ],
                        ["TRUE"],
                        [
                            ["DO_LOG", "$LOG_EVENT", "$ACTOR_PLAYER", "$TARGET_PLAYER", "discard {{$TARGET_NAME}}{{$SUFFIX}}.", "discards {{$TARGET_NAME}}{{$SUFFIX}}."],
                            ["DO_FORCE_DISCARD_ALL_ATTACHED_CARDS", "$TARGET_PLAYER", "$TARGET_CARD_ID", "$LOG_EVENT", null],
                            ["MOVE_CARD", "$TARGET_CARD_ID", ["GET_CONTROLLER_DISCARD", "$TARGET_CARD.cardOwner"], 0, 0]
                        ]
                    ],
                    ["NOT_EQUAL", "$TARGET_CARD.cardDiscard", ""],
                    [
                        ["VAR", "$DISCARD_GROUP", ["GET_GROUP_AND_VALIDATE", "$TARGET_CARD.cardDiscard", "DO_DISCARD_CARD_FINAL.TARGET_CARD.cardDiscard"]],
                        ["DO_LOG", "$LOG_EVENT", "$ACTOR_PLAYER", "$TARGET_PLAYER", "discard {{$TARGET_NAME}}{{$SUFFIX}} to {{$DISCARD_GROUP.label}}.", "discards {{$TARGET_NAME}}{{$SUFFIX}} to {{$DISCARD_GROUP.label}}."],
                        ["DO_FORCE_DISCARD_ALL_ATTACHED_CARDS", "$TARGET_PLAYER", "$TARGET_CARD_ID", "$LOG_EVENT", null],
                        ["MOVE_CARD", "$TARGET_CARD_ID", "$TARGET_CARD.cardDiscard", 0, 0]
                    ]
                ]
            ]
        },
        "DO_DISCARD_CARD_ACT": {
            "args": ["$TARGET_PLAYER", "$TARGET_CARD_ID"],
            "code": [
                ["DO_DISCARD_CARD_FINAL", "$TARGET_PLAYER", "$TARGET_CARD_ID", "", true, null]
            ]
        },
        "CAN_DISCARD_RANDOM_CARDS_FROM_HAND": {
            "args": ["$TARGET_PLAYER", "$TARGET_GROUP_ID", "$ACTOR_PLAYER"],
            "code": [
                ["VALIDATE_PLAYER", "$TARGET_PLAYER", "CAN_DISCARD_RANDOM_CARDS_FROM_HAND.TARGET_PLAYER"],
                ["VAR", "$TARGET_GROUP", ["GET_GROUP_AND_VALIDATE", "$TARGET_GROUP_ID", "CAN_DISCARD_RANDOM_CARDS_FROM_HAND.TARGET_GROUP_ID"]],
                ["AND",
                    ["EQUAL", "$TARGET_GROUP_ID", ["GET_CONTROLLER_HAND", "$TARGET_PLAYER"]],
                    ["GREATER_THAN", ["LENGTH", "$TARGET_GROUP.stackIds"], 1]
                ]
            ]
        },
        "DO_DISCARD_RANDOM_CARDS_FROM_HAND": {
            "args": ["$TARGET_PLAYER", "$TARGET_GROUP_ID", "$LOG_EVENT", "$ACTOR_PLAYER"],
            "code": [
                ["VALIDATE_PLAYER", "$TARGET_PLAYER", "DO_DISCARD_RANDOM_CARDS_FROM_HAND.TARGET_PLAYER"],
                ["VAR", "$TARGET_GROUP", ["GET_GROUP_AND_VALIDATE", "$TARGET_GROUP_ID", "DO_DISCARD_RANDOM_CARDS_FROM_HAND.TARGET_GROUP_ID"]],
                ["VALIDATE_BOOLEAN", "$LOG_EVENT", "DO_DISCARD_RANDOM_CARDS_FROM_HAND.LOG_EVENT"],
                ["COND",
                    ["CAN_DISCARD_RANDOM_CARDS_FROM_HAND", "$TARGET_PLAYER", "$TARGET_GROUP_ID", "$ACTOR_PLAYER"],
                    [
                        ["VAR", "$AVAILABLE_NUMBER", ["LENGTH", "$TARGET_GROUP.stackIds"]],
                        ["COND",
                            ["GREATER_THAN", "$AVAILABLE_NUMBER", 11],
                            ["UPDATE_VAR", "$AVAILABLE_NUMBER", 11]
                        ],
                        ["PROMPT", "$TARGET_PLAYER", "askHowManyToDiscard", "$LOG_EVENT", "$ACTOR_PLAYER"],
                        ["FOR_EACH_START_STOP_STEP", "$I", 1, "$AVAILABLE_NUMBER", 1, [
                            ["VAR", "$LETTER", ["SUBSTRING", "X1234567890", "$I", 1]],
                            ["PROMPT_ADD_OPTION", "$TARGET_PLAYER", ["GET_NUMERIC_LOG", "", "", "$I", " card.", " cards."], "{{$LETTER}}", ["LIST", "DO_DISCARD_N_RANDOM_CARDS_FROM_HAND_STR", "{{$TARGET_PLAYER}}", "{{$I}}", "{{$LOG_EVENT}}", "{{$ACTOR_PLAYER}}"]]
                        ]]
                    ]
                ]
            ]
        },
        "DO_DISCARD_N_RANDOM_CARDS_FROM_HAND": {
            "args": ["$TARGET_PLAYER", "$NUMBER", "$LOG_EVENT", "$ACTOR_PLAYER"],
            "code": [
                ["VALIDATE_PLAYER", "$TARGET_PLAYER", "DO_DISCARD_N_RANDOM_CARDS_FROM_HAND.TARGET_PLAYER"],
                ["VALIDATE_GT0", "$NUMBER", "DO_DISCARD_N_RANDOM_CARDS_FROM_HAND.NUMBER"],
                ["VALIDATE_BOOLEAN", "$LOG_EVENT", "DO_DISCARD_N_RANDOM_CARDS_FROM_HAND.LOG_EVENT"],
                ["VAR", "$TARGET_GROUP_ID", ["GET_CONTROLLER_HAND", "$TARGET_PLAYER"]],
                ["VAR", "$TARGET_GROUP", ["GET_GROUP_AND_VALIDATE", "$TARGET_GROUP_ID", "DO_DISCARD_N_RANDOM_CARDS_FROM_HAND.TARGET_GROUP_ID"]],
                ["VAR", "$AVAILABLE_NUMBER", ["LENGTH", "$TARGET_GROUP.stackIds"]],
                ["COND",
                    ["GREATER_THAN", "$AVAILABLE_NUMBER", 0],
                    [
                        ["COND",
                            ["GREATER_EQUAL", "$AVAILABLE_NUMBER", "$NUMBER"],
                            ["DO_LOG", "$LOG_EVENT", "$ACTOR_PLAYER", "$TARGET_PLAYER",
                                ["GET_NUMERIC_LOG", "discard ", "discard ", "$NUMBER", " random card from hand.", " random cards from hand."],
                                ["GET_NUMERIC_LOG", "discards ", "discards ", "$NUMBER", " random card from hand.", " random cards from hand."]
                            ],
                            ["TRUE"],
                            [
                                ["DO_LOG", "$LOG_EVENT", "$ACTOR_PLAYER", "$TARGET_PLAYER",
                                    ["GET_NUMERIC_LOG", "discard {{$AVAILABLE_NUMBER}} out of ", "discard {{$AVAILABLE_NUMBER}} out of ", "$NUMBER", " random card from hand.", " random cards from hand."],
                                    ["GET_NUMERIC_LOG", "discards {{$AVAILABLE_NUMBER}} out of ", "discards {{$AVAILABLE_NUMBER}} out of ", "$NUMBER", " random card from hand.", " random cards from hand."]
                                ],
                                ["UPDATE_VAR", "$NUMBER", "$AVAILABLE_NUMBER"]
                            ]
                        ],
                        ["VAR", "$SELECTED_CARDS", ["CHOOSE_N", ["GET_ALL_CARDS_IN_GROUP", "$TARGET_GROUP_ID"], "$NUMBER"]],
                        ["FOR_EACH_VAL", "$CARD", "$SELECTED_CARDS", [
                            ["DO_DISCARD_CARD", "$TARGET_PLAYER", "$CARD.id", "$LOG_EVENT", null]
                        ]]
                    ]
                ]
            ]
        },
        "DO_DISCARD_N_RANDOM_CARDS_FROM_HAND_STR": {
            "args": ["$TARGET_PLAYER", "$NUMBER", "$LOG_EVENT", "$ACTOR_PLAYER"],
            "code": [
                ["DO_DISCARD_N_RANDOM_CARDS_FROM_HAND", "$TARGET_PLAYER", ["CALC", "{{$NUMBER}}"], ["EQUAL", "{{$LOG_EVENT}}", "true"], "$ACTOR_PLAYER"]
            ]
        },
        "CAN_SELECT_RANDOM_CARDS_IN_HAND": {
            "args": ["$TARGET_PLAYER", "$TARGET_GROUP_ID", "$ACTOR_PLAYER"],
            "code": [
                ["VALIDATE_PLAYER", "$TARGET_PLAYER", "CAN_SELECT_RANDOM_CARDS_IN_HAND.TARGET_PLAYER"],
                ["VAR", "$TARGET_GROUP", ["GET_GROUP_AND_VALIDATE", "$TARGET_GROUP_ID", "CAN_SELECT_RANDOM_CARDS_IN_HAND.TARGET_GROUP_ID"]],
                ["AND",
                    ["EQUAL", "$TARGET_GROUP_ID", ["GET_CONTROLLER_HAND", "$TARGET_PLAYER"]],
                    ["GREATER_THAN", ["LENGTH", "$TARGET_GROUP.stackIds"], 1]
                ]
            ]
        },
        "DO_SELECT_RANDOM_CARDS_IN_HAND": {
            "args": ["$TARGET_PLAYER", "$TARGET_GROUP_ID", "$LOG_EVENT", "$ACTOR_PLAYER"],
            "code": [
                ["VALIDATE_PLAYER", "$TARGET_PLAYER", "DO_SELECT_RANDOM_CARDS_IN_HAND.TARGET_PLAYER"],
                ["VAR", "$TARGET_GROUP", ["GET_GROUP_AND_VALIDATE", "$TARGET_GROUP_ID", "DO_SELECT_RANDOM_CARDS_IN_HAND.TARGET_GROUP_ID"]],
                ["VALIDATE_BOOLEAN", "$LOG_EVENT", "DO_SELECT_RANDOM_CARDS_IN_HAND.LOG_EVENT"],
                ["COND",
                    ["CAN_SELECT_RANDOM_CARDS_IN_HAND", "$TARGET_PLAYER", "$TARGET_GROUP_ID", "$ACTOR_PLAYER"],
                    [
                        ["VAR", "$AVAILABLE_NUMBER", ["LENGTH", "$TARGET_GROUP.stackIds"]],
                        ["COND",
                            ["GREATER_THAN", "$AVAILABLE_NUMBER", 11],
                            ["UPDATE_VAR", "$AVAILABLE_NUMBER", 11]
                        ],
                        ["PROMPT", "$TARGET_PLAYER", "askHowManyToSelect", "$LOG_EVENT", "$ACTOR_PLAYER"],
                        ["FOR_EACH_START_STOP_STEP", "$I", 1, "$AVAILABLE_NUMBER", 1, [
                            ["VAR", "$LETTER", ["SUBSTRING", "X1234567890", "$I", 1]],
                            ["PROMPT_ADD_OPTION", "$TARGET_PLAYER", ["GET_NUMERIC_LOG", "", "", "$I", " card.", " cards."], "{{$LETTER}}", ["LIST", "DO_SELECT_N_RANDOM_CARDS_IN_HAND_STR", "{{$TARGET_PLAYER}}", "{{$I}}", "{{$LOG_EVENT}}", "{{$ACTOR_PLAYER}}"]]
                        ]]
                    ]
                ]
            ]
        },
        "DO_SELECT_N_RANDOM_CARDS_IN_HAND": {
            "args": ["$TARGET_PLAYER", "$NUMBER", "$LOG_EVENT", "$ACTOR_PLAYER"],
            "code": [
                ["VALIDATE_PLAYER", "$TARGET_PLAYER", "DO_SELECT_N_RANDOM_CARDS_IN_HAND.TARGET_PLAYER"],
                ["VALIDATE_GT0", "$NUMBER", "DO_SELECT_N_RANDOM_CARDS_IN_HAND.NUMBER"],
                ["VALIDATE_BOOLEAN", "$LOG_EVENT", "DO_SELECT_N_RANDOM_CARDS_IN_HAND.LOG_EVENT"],
                ["VAR", "$TARGET_GROUP_ID", ["GET_CONTROLLER_HAND", "$TARGET_PLAYER"]],
                ["VAR", "$TARGET_GROUP", ["GET_GROUP_AND_VALIDATE", "$TARGET_GROUP_ID", "DO_SELECT_N_RANDOM_CARDS_IN_HAND.TARGET_GROUP_ID"]],
                ["VAR", "$AVAILABLE_NUMBER", ["LENGTH", "$TARGET_GROUP.stackIds"]],
                ["COND",
                    ["GREATER_THAN", "$AVAILABLE_NUMBER", 0],
                    [
                        ["COND",
                            ["GREATER_EQUAL", "$AVAILABLE_NUMBER", "$NUMBER"],
                            ["DO_LOG", "$LOG_EVENT", "$ACTOR_PLAYER", "$TARGET_PLAYER",
                                ["GET_NUMERIC_LOG", "target ", "target ", "$NUMBER", " random card in hand.", " random cards in hand."],
                                ["GET_NUMERIC_LOG", "targets ", "targets ", "$NUMBER", " random card in hand.", " random cards in hand."]
                            ],
                            ["TRUE"],
                            [
                                ["DO_LOG", "$LOG_EVENT", "$ACTOR_PLAYER", "$TARGET_PLAYER",
                                    ["GET_NUMERIC_LOG", "target {{$AVAILABLE_NUMBER}} out of ", "target {{$AVAILABLE_NUMBER}} out of ", "$NUMBER", " random card in hand.", " random cards in hand."],
                                    ["GET_NUMERIC_LOG", "targets {{$AVAILABLE_NUMBER}} out of ", "targets {{$AVAILABLE_NUMBER}} out of ", "$NUMBER", " random card in hand.", " random cards in hand."]
                                ],
                                ["UPDATE_VAR", "$NUMBER", "$AVAILABLE_NUMBER"]
                            ]
                        ],
                        ["VAR", "$SELECTED_CARDS", ["CHOOSE_N", ["GET_ALL_CARDS_IN_GROUP", "$TARGET_GROUP_ID"], "$NUMBER"]],
                        ["FOR_EACH_VAL", "$CARD", "$SELECTED_CARDS", [
                            ["TARGET", "$CARD.id"]
                        ]]
                    ]
                ]
            ]
        },
        "DO_SELECT_N_RANDOM_CARDS_IN_HAND_STR": {
            "args": ["$TARGET_PLAYER", "$NUMBER", "$LOG_EVENT", "$ACTOR_PLAYER"],
            "code": [
                ["DO_SELECT_N_RANDOM_CARDS_IN_HAND", "$TARGET_PLAYER", ["CALC", "{{$NUMBER}}"], ["EQUAL", "{{$LOG_EVENT}}", "true"], "$ACTOR_PLAYER"]
            ]
        },
        "DO_FORCE_DISCARD": {
            "args": ["$TARGET_PLAYER", "$TARGET_CARD_ID", "$LOG_EVENT", "$ACTOR_PLAYER"],
            "code": [
                ["VALIDATE_PLAYER", "$TARGET_PLAYER", "DO_FORCE_DISCARD.TARGET_PLAYER"],
                ["VAR", "$TARGET_CARD", ["GET_CARD_AND_VALIDATE", "$TARGET_CARD_ID", "DO_FORCE_DISCARD.TARGET_CARD_ID"]],
                ["VALIDATE_BOOLEAN", "$LOG_EVENT", "DO_FORCE_DISCARD.LOG_EVENT"],
                ["VAR", "$CONTROLLER", ["GET_PLAYER_CONTROLLER", "$TARGET_PLAYER", "$TARGET_CARD_ID"]],
                ["COND",
                    ["GREATER_THAN", ["GET_DISCARD_CARD_MODE", "$CONTROLLER", "$TARGET_CARD_ID", "$ACTOR_PLAYER"], 0],
                    ["DO_DISCARD_CARD", "$CONTROLLER", "$TARGET_CARD_ID", "$LOG_EVENT", "$ACTOR_PLAYER"],
                    ["TRUE"],
                    ["COND",
                        ["EQUAL", ["GET_PLAYER_ELIMINATED", "$TARGET_CARD.cardOwner"], true],
                        [
                            ["DO_LOG", "$LOG_EVENT", "$ACTOR_PLAYER", "$CONTROLLER", "remove {{$TARGET_CARD.currentFace.name}} from the game.", "removes {{$TARGET_CARD.currentFace.name}} from the game."],
                            ["MOVE_CARD", "$TARGET_CARD_ID", ["GET_CONTROLLER_REMOVED", "$TARGET_CARD.cardOwner"], -1]
                        ],
                        ["TRUE"],
                        [
                            ["DO_LOG", "$LOG_EVENT", "$ACTOR_PLAYER", "$CONTROLLER", "discard {{$TARGET_CARD.currentFace.name}}.", "discards {{$TARGET_CARD.currentFace.name}}."],
                            ["MOVE_CARD", "$TARGET_CARD_ID", ["GET_CONTROLLER_DISCARD", "$TARGET_CARD.cardOwner"], 0, 0]
                        ]
                    ]
                ]
            ]
        },
        "DO_FORCE_DISCARD_ALL_ATTACHED_CARDS": {
            "args": ["$TARGET_PLAYER", "$TARGET_CARD_ID", "$LOG_EVENT", "$ACTOR_PLAYER"],
            "code": [
                ["VALIDATE_PLAYER", "$TARGET_PLAYER", "DO_FORCE_DISCARD_ALL_ATTACHED_CARDS.TARGET_PLAYER"],
                ["VAR", "$TARGET_CARD", ["GET_CARD_AND_VALIDATE", "$TARGET_CARD_ID", "DO_FORCE_DISCARD_ALL_ATTACHED_CARDS.TARGET_CARD_ID"]],
                ["VALIDATE_BOOLEAN", "$LOG_EVENT", "DO_FORCE_DISCARD_ALL_ATTACHED_CARDS.LOG_EVENT"],
                ["COND",
                    ["GREATER_THAN", ["GET_ATTACHED_CARDS_COUNT", "$TARGET_CARD_ID"], 0],
                    [
                        ["VAR", "$SELECTED_CARDS", ["GET_ATTACHED_CARDS", "$TARGET_CARD_ID"]],
                        ["FOR_EACH_VAL", "$CARD", "$SELECTED_CARDS", [
                            ["VAR", "$CONTROLLER", ["GET_PLAYER_CONTROLLER", "$TARGET_PLAYER", "$CARD.id"]],
                            ["COND",
                                ["GREATER_THAN", ["GET_DISCARD_CARD_MODE", "$CONTROLLER", "$CARD.id", "$ACTOR_PLAYER"], 0],
                                ["DO_DISCARD_CARD", "$CONTROLLER", "$CARD.id", "$LOG_EVENT", "$ACTOR_PLAYER"],
                                ["TRUE"],
                                ["COND",
                                    ["EQUAL", ["GET_PLAYER_ELIMINATED", "$CARD.cardOwner"], true],
                                    [
                                        ["DO_LOG", "$LOG_EVENT", "$ACTOR_PLAYER", "$CONTROLLER", "remove {{$CARD.currentFace.name}} from the game.", "removes {{$CARD.currentFace.name}} from the game."],
                                        ["MOVE_CARD", "$CARD.id", ["GET_CONTROLLER_REMOVED", "$CARD.cardOwner"], -1]
                                    ],
                                    ["TRUE"],
                                    [
                                        ["DO_LOG", "$LOG_EVENT", "$ACTOR_PLAYER", "$CONTROLLER", "discard {{$CARD.currentFace.name}}.", "discards {{$CARD.currentFace.name}}."],
                                        ["MOVE_CARD", "$CARD.id", ["GET_CONTROLLER_DISCARD", "$CARD.cardOwner"], 0, 0]
                                    ]
                                ]
                            ]
                        ]]
                    ]
                ]
            ]
        },
        "DISCARD_EXCESS_CARDS": {
            "args": ["$TARGET_PLAYER", "$CARDS_TO_DISCARD", "$SELECTED_CARDS"],
            "code": [
                ["VALIDATE_PLAYER", "$TARGET_PLAYER", "DISCARD_EXCESS_CARDS.TARGET_PLAYER"],
                ["VALIDATE_GT0", "$CARDS_TO_DISCARD", "DISCARD_EXCESS_CARDS.CARDS_TO_DISCARD"],
                ["LOGF", "{0} discards {1:INT} of {2} excess card{2:S} from hand.", "$TARGET_PLAYER", "$SELECTED_CARDS", "$CARDS_TO_DISCARD"],
                ["COND",
                    ["AND",
                        ["NOT_EQUAL", "$SELECTED_CARDS", null],
                        ["GREATER_THAN", ["LENGTH", "$SELECTED_CARDS"], 0]
                    ],
                    [
                        ["FOR_EACH_VAL", "$CARD", "$SELECTED_CARDS", [
                            ["DO_DISCARD_CARD", "$TARGET_PLAYER", "$CARD.id", true, null]
                        ]]
                    ]
                ],
                ["DO_CHECK_HAND_SIZE", "$TARGET_PLAYER"]
            ]
        },
        "DO_MOVE_TO_VICTORY_DISPLAY": {
            "args": ["$TARGET_PLAYER", "$TARGET_CARD_ID", "$LOG_EVENT", "$ACTOR_PLAYER"],
            "code": [
                ["VALIDATE_PLAYER", "$TARGET_PLAYER", "DO_MOVE_TO_VICTORY_DISPLAY.TARGET_PLAYER"],
                ["VAR", "$TARGET_CARD", ["GET_CARD_AND_VALIDATE", "$TARGET_CARD_ID", "DO_MOVE_TO_VICTORY_DISPLAY.TARGET_CARD_ID"]],
                ["VALIDATE_BOOLEAN", "$LOG_EVENT", "DO_MOVE_TO_VICTORY_DISPLAY.LOG_EVENT"],
                ["VAR", "$TARGET_NAME", ["GET_CARD_NAME", "$TARGET_CARD_ID"]],
                ["DO_LOG", "$LOG_EVENT", "$ACTOR_PLAYER", "$TARGET_PLAYER", "move {{$TARGET_NAME}} to the Victory Display.", "moves {{$TARGET_NAME}} to the Victory Display."],
                ["DO_FORCE_DISCARD_ALL_ATTACHED_CARDS", "$TARGET_PLAYER", "$TARGET_CARD_ID", "$LOG_EVENT", null],
                ["MOVE_CARD", "$TARGET_CARD_ID", "sharedVictoryDisplay", -1]
            ]
        },
        "CAN_LEAVE_PLAY": {
            "args": ["$TARGET_CARD_ID", "$AUTOMATIC"],
            "code": [
                ["VAR", "$TARGET_CARD", ["GET_CARD_AND_VALIDATE", "$TARGET_CARD_ID", "CAN_LEAVE_PLAY.TARGET_CARD_ID"]],
                ["VALIDATE_BOOLEAN", "$AUTOMATIC", "CAN_LEAVE_PLAY.AUTOMATIC"],
                ["COND",
                    ["OR",
                        ["EQUAL", "$TARGET_CARD.sides.A.databaseId", "03009"], //Sophie: In Loving Memory (Sophie cannot leave play.)
                        ["EQUAL", "$TARGET_CARD.sides.A.databaseId", "08113"]  //Unscrupulous Loan (Cannot leave play.)
                    ],
                    false,
                    ["AND",
                        ["OR",
                            ["EQUAL", "$TARGET_CARD.sides.A.databaseId", "03011"], //The King in Yellow: Act 1 (It cannot leave play except through the (reaction) ability below.)
                            ["EQUAL", "$TARGET_CARD.sides.A.databaseId", "10135"], //Maimed Hand (It cannot leave play except by the (action) (action) ability below.)
                            ["EQUAL", "$TARGET_CARD.sides.A.databaseId", "10136"], //Back Injury
                            ["EQUAL", "$TARGET_CARD.sides.A.databaseId", "10137"], //The Silver Moth
                            ["EQUAL", "$TARGET_CARD.sides.A.databaseId", "10138"]  //Vow of Drzytelech
                        ],
                        ["EQUAL", "$AUTOMATIC", true]
                    ],
                    false,
                    ["AND",
                        ["OR",
                            ["EQUAL", "$TARGET_CARD.sides.A.databaseId", "01009"], //The Necronomicon: John Dee Translation (It cannot leave play while it has 1 or more horror on it.)
                            ["EQUAL", "$TARGET_CARD.sides.A.databaseId", "01509"], //The Necronomicon: John Dee Translation
                            ["EQUAL", "$TARGET_CARD.sides.A.databaseId", "90003"]  //The Necronomicon: John Dee Translation
                        ],
                        ["GREATER_THAN", ["GET_HORROR_ON_CARD", "$TARGET_CARD_ID"], 0]
                    ],
                    false,
                    ["AND",
                        ["OR",
                            ["EQUAL", "$TARGET_CARD.sides.A.databaseId", "05019"], //Baron Samedi: Lord of the Cemetery (He cannot leave play while he has less than 3 doom on him.)
                            ["EQUAL", "$TARGET_CARD.sides.A.databaseId", "99003"]  //Baron Samedi: Lord of the Cemetery (promo)
                        ],
                        ["LESS_THAN", ["GET_DOOM_ON_CARD", "$TARGET_CARD_ID"], 3]
                    ],
                    false,
                    ["AND",
                        ["EQUAL", "$TARGET_CARD.sides.A.databaseId", "09007"], //Wounded Bystander: On Death's Doorstep (It cannot leave play while it has damage (unless it is defeated).)
                        ["GREATER_THAN", ["GET_DAMAGE_ON_CARD", "$TARGET_CARD_ID"], 0],
                        ["LESS_THAN", ["GET_DAMAGE_ON_CARD", "$TARGET_CARD_ID"], 5]
                    ],
                    false,
                    ["AND",
                        ["EQUAL", "$TARGET_CARD.sides.A.databaseId", "53012"], //Dendromorphosis: "Natural" Transformation (It cannot leave play while it has no damage on it.)
                        ["EQUAL", ["GET_DAMAGE_ON_CARD", "$TARGET_CARD_ID"], 0]
                    ],
                    false,
                    ["TRUE"],
                    true
                ]
            ]
        }
    },
    "prompts": {
        "victoryOrDiscardHand": {
            "args": ["$TARGET_CARD_ID", "$LOG_EVENT", "$ACTOR_PLAYER"],
            "message": "{{$CARD_BY_ID.$TARGET_CARD_ID.sides.A.name}} is Victory or Vengeance card. Select destination.",
            "options": [
                {
                    "label": "Victory Display.",
                    "hotkey": "V",
                    "code": [
                        ["VAR", "$TARGET_CARD", "$CARD_BY_ID.$TARGET_CARD_ID"],
                        ["DO_LOG", "$LOG_EVENT", "$ACTOR_PLAYER", "$PLAYER_N", "move {{$TARGET_CARD.sides.A.name}} from hand to the Victory Display.", "moves {{$TARGET_CARD.sides.A.name}} from hand to the Victory Display."],
                        ["MOVE_CARD", "$TARGET_CARD_ID", "sharedVictoryDisplay", -1]
                    ]
                },
                {
                    "label": "Discard Pile.",
                    "hotkey": "D",
                    "code": [
                        ["DO_DISCARD_CARD_FINAL", "$PLAYER_N", "$TARGET_CARD_ID", " from hand", "$LOG_EVENT", "$ACTOR_PLAYER"]
                    ]
                }
            ]
        },
        "victoryOrDiscardPlay": {
            "args": ["$TARGET_CARD_ID", "$LOG_EVENT", "$ACTOR_PLAYER"],
            "message": "{{$CARD_BY_ID.$TARGET_CARD_ID.currentFace.name}} is Victory or Vengeance card. Select destination.",
            "options": [
                {
                    "label": "Victory Display.",
                    "hotkey": "V",
                    "code": [
                        ["VAR", "$TARGET_CARD", "$CARD_BY_ID.$TARGET_CARD_ID"],
                        ["DO_LOG", "$LOG_EVENT", "$ACTOR_PLAYER", "$PLAYER_N", "move {{$TARGET_CARD.currentFace.name}} to the Victory Display.", "moves {{$TARGET_CARD.currentFace.name}} to the Victory Display."],
                        ["DO_FORCE_DISCARD_ALL_ATTACHED_CARDS", "$PLAYER_N", "$TARGET_CARD_ID", "$LOG_EVENT", null],
                        ["MOVE_CARD", "$TARGET_CARD_ID", "sharedVictoryDisplay", -1]
                    ]
                },
                {
                    "label": "Discard Pile.",
                    "hotkey": "D",
                    "code": [
                        ["DO_DISCARD_CARD_FINAL", "$PLAYER_N", "$TARGET_CARD_ID", "", "$LOG_EVENT", "$ACTOR_PLAYER"]
                    ]
                }
            ]
        },
        "askToDiscardExcessCards": {
            "args": ["$CARDS_TO_DISCARD"],
            "message": "You should discard {{$CARDS_TO_DISCARD}} excess card(s) from hand. Select cards to discard.",
            "input": {
                "type": "selectCards"
            },
            "options": [
                {
                    "label": "Yes, discard selected cards (follow the rules).",
                    "hotkey": "Y",
                    "code": [
                        ["DISCARD_EXCESS_CARDS", "$PLAYER_N", "$CARDS_TO_DISCARD", ["GET_SELECTED_CARDS_IN_GROUP", ["GET_CONTROLLER_HAND", "$PLAYER_N"], "$PROMPT_INPUT"]]
                    ]
                },
                {
                    "label": "No, skip that (ignore the rules).",
                    "hotkey": "N",
                    "code": [
                        ["LOGF", "{0} skips discarding {1} excess card{1:S} from hand.", "$PLAYER_N", "$CARDS_TO_DISCARD"],
                        ["DO_CHECK_HAND_SIZE", ["GET_NEXT_ACTIVE_PLAYER", "$PLAYER_N"]]
                    ]
                }
            ]
        },
        "askHowManyToDiscard": {
            "args": ["$LOG_EVENT", "$ACTOR_PLAYER"],
            "message": "How many random cards do you want to discard from hand?",
            "options": [
            ]
        },
        "askHowManyToSelect": {
            "args": ["$LOG_EVENT", "$ACTOR_PLAYER"],
            "message": "How many random cards do you want to target in hand?",
            "options": [
            ]
        }
    },
    "labels": {
        "discardCard": {
            "English": "Discard"
        },
        "discardCardMenu": {
            "English": "Discard (X)"
        },
        "discardVoid": {
            "English": "Discard Limbo"
        },
        "discardVoidMenu": {
            "English": "Discard Limbo (Shift+X)"
        },
        "discardRandomCardsFromHandMenu": {
            "English": "Discard N random cards"
        },
        "selectRandomCardsInHandMenu": {
            "English": "Target N random cards"
        }
    }
}